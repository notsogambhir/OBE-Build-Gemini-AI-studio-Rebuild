{
  "index.tsx": "import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport { AppProvider } from './context/AppContext';\nimport App from './App';\nimport { Chart as ChartJS, CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend } from 'chart.js';\n\n// Register Chart.js components\nChartJS.register(CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend);\n\nconst rootElement = document.getElementById('root');\nif (!rootElement) {\n  throw new Error(\"Could not find root element to mount to\");\n}\n\nconst root = ReactDOM.createRoot(rootElement);\nroot.render(\n  <React.StrictMode>\n    <AppProvider>\n      <App />\n    </AppProvider>\n  </React.StrictMode>\n);",
  "metadata.json": "{\n  \"name\": \"NBA Outcome Based Education Portal\",\n  \"description\": \"A comprehensive application for managing and calculating Course Outcome (CO) and Program Outcome (PO) attainment based on National Board of Accreditation (NBA) guidelines for Outcome Based Education (OBE).\",\n  \"requestFramePermissions\": []\n}",
  "index.html": "<!DOCTYPE html>\n<html lang=\"en\" class=\"h-full\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <link rel=\"icon\" type=\"image/png\" href=\"https://d1hbpr09pwz0sk.cloudfront.net/logo_url/chitkara-university-4c35e411\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>NBA OBE Portal</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script src=\"https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js\"></script>\n  <script type=\"importmap\">\n{\n  \"imports\": {\n    \"react\": \"https://aistudiocdn.com/react@^19.1.1\",\n    \"react-dom/\": \"https://aistudiocdn.com/react-dom@^19.1.1/\",\n    \"react/\": \"https://aistudiocdn.com/react@^19.1.1/\",\n    \"chart.js\": \"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/+esm\",\n    \"react-chartjs-2\": \"https://cdn.jsdelivr.net/npm/react-chartjs-2@5.2.0/+esm\",\n    \"react-router-dom\": \"https://aistudiocdn.com/react-router-dom@^7.9.2\"\n  }\n}\n</script>\n</head>\n  <body class=\"h-full bg-gray-100 text-gray-800\" style=\"transform: scale(0.75); transform-origin: top left; width: 133.33vw; height: 133.33vh;\">\n    <div id=\"root\" class=\"h-full\"></div>\n    <script type=\"module\" src=\"/index.tsx\"></script>\n  </body>\n</html>",
  "App.tsx": "import React from 'react';\nimport { HashRouter, Routes, Route, Navigate, useLocation } from 'react-router-dom';\nimport { useAppContext } from './hooks/useAppContext';\n\nimport LoginScreen from './pages/LoginScreen';\nimport ProgramSelectionScreen from './pages/ProgramSelectionScreen';\nimport MainLayout from './components/MainLayout';\nimport Dashboard from './pages/Dashboard';\nimport CoursesList from './pages/CoursesList';\nimport CourseDetail from './pages/CourseDetail';\nimport ProgramOutcomesList from './pages/ProgramOutcomesList';\nimport StudentCOAttainmentReport from './pages/StudentCOAttainmentReport';\nimport AttainmentReports from './pages/AttainmentReports';\nimport StudentsList from './pages/StudentsList';\nimport TeacherManagement from './pages/TeacherManagement';\nimport TeacherDetails from './pages/TeacherDetails';\nimport DepartmentStudentManagement from './pages/DepartmentStudentManagement';\nimport DepartmentFacultyManagement from './pages/DepartmentFacultyManagement';\nimport AdminPanel from './pages/AdminPanel';\n\nconst ProtectedRoutes: React.FC = () => {\n    const { currentUser, selectedProgram, selectedBatch } = useAppContext();\n    const location = useLocation();\n\n    if (!currentUser) {\n        return <Navigate to=\"/login\" state={{ from: location }} replace />;\n    }\n\n    // Department user workflow\n    if (currentUser.role === 'Department') {\n        return (\n            <MainLayout>\n                <Routes>\n                    <Route path=\"/department/students\" element={<DepartmentStudentManagement />} />\n                    <Route path=\"/department/faculty\" element={<DepartmentFacultyManagement />} />\n                    <Route path=\"*\" element={<Navigate to=\"/department/students\" replace />} />\n                </Routes>\n            </MainLayout>\n        );\n    }\n\n    // Admin user workflow\n    if (currentUser.role === 'Admin') {\n        return (\n             <MainLayout>\n                <Routes>\n                    {/* Admin-specific routes */}\n                    <Route path=\"/admin/academic-structure\" element={<AdminPanel view=\"Academic Structure\" />} />\n                    <Route path=\"/admin/user-management\" element={<AdminPanel view=\"User Management\" />} />\n                    <Route path=\"/admin/system-settings\" element={<AdminPanel view=\"System Settings\" />} />\n\n                    {/* Standard routes also accessible by Admin */}\n                    <Route path=\"/dashboard\" element={<Dashboard />} />\n                    <Route path=\"/courses\" element={<CoursesList />} />\n                    <Route path=\"/courses/:courseId\" element={<CourseDetail />} />\n                    <Route path=\"/courses/:courseId/report\" element={<StudentCOAttainmentReport />} />\n                    <Route path=\"/program-outcomes\" element={<ProgramOutcomesList />} />\n                    <Route path=\"/students\" element={<StudentsList />} />\n                    <Route path=\"/reports\" element={<AttainmentReports />} />\n                    \n                    {/* Default admin route */}\n                    <Route path=\"*\" element={<Navigate to=\"/dashboard\" replace />} />\n                </Routes>\n            </MainLayout>\n        );\n    }\n    \n    // Program selection gate for other roles\n    const needsProgramSelection = !selectedProgram || !selectedBatch;\n    if (needsProgramSelection && currentUser.role !== 'University') {\n        return <ProgramSelectionScreen />;\n    }\n    \n    // Default workflow for authenticated users with a selected program\n    return (\n        <MainLayout>\n            <Routes>\n                <Route path=\"/dashboard\" element={<Dashboard />} />\n                <Route path=\"/courses\" element={<CoursesList />} />\n                <Route path=\"/courses/:courseId\" element={<CourseDetail />} />\n                <Route path=\"/courses/:courseId/report\" element={<StudentCOAttainmentReport />} />\n                <Route path=\"/program-outcomes\" element={<ProgramOutcomesList />} />\n                <Route path=\"/students\" element={<StudentsList />} />\n                <Route path=\"/teachers\" element={<TeacherManagement />} />\n                <Route path=\"/teachers/:teacherId\" element={<TeacherDetails />} />\n                <Route path=\"/reports\" element={<AttainmentReports />} />\n                <Route path=\"/program-selection\" element={<ProgramSelectionScreen />} />\n                <Route path=\"*\" element={<Navigate to=\"/dashboard\" replace />} />\n            </Routes>\n        </MainLayout>\n    );\n};\n\n\nconst App: React.FC = () => {\n  const { currentUser } = useAppContext();\n\n  return (\n    <HashRouter>\n        <Routes>\n            <Route path=\"/login\" element={<LoginScreen />} />\n            <Route path=\"/*\" element={currentUser ? <ProtectedRoutes /> : <Navigate to=\"/login\" />} />\n        </Routes>\n    </HashRouter>\n  );\n};\n\nexport default App;",
  "types.ts": "// --- Enums and Basic Types ---\nexport type Role = 'Teacher' | 'Program Co-ordinator' | 'University' | 'Admin' | 'Department';\nexport type College = 'CUIET' | 'CCP' | 'CBS';\nexport type CourseStatus = 'Active' | 'Completed' | 'Future';\nexport type StudentStatus = 'Active' | 'Inactive';\n\n// --- System-wide Settings ---\nexport interface SystemSettings {\n  defaultCoTarget: number;\n  defaultAttainmentLevels: {\n    level3: number;\n    level2: number;\n    level1: number;\n  };\n  defaultWeights: {\n    direct: number;\n    indirect: number;\n  };\n}\n\n\n// --- Data Structures ---\nexport interface User {\n  id: string;\n  employeeId: string;\n  username: string;\n  password?: string;\n  role: Role;\n  name: string;\n  // For Program Co-ordinators: The ID of the single program they manage\n  programId?: string;\n  // For Teachers: ID of the Program Co-ordinator who manages them\n  programCoordinatorIds?: string[];\n  status?: 'Active' | 'Inactive';\n  // For Department: The ID of the college they manage\n  collegeId?: College;\n  // For Program Co-ordinators: ID of the Department Head who manages them\n  departmentId?: string;\n}\n\nexport interface Program {\n  id: string;\n  name: string;\n  collegeId: College;\n  duration: number; // in years\n}\n\nexport interface Batch {\n  id: string;\n  programId: string;\n  name: string; // e.g. \"2025-2029\"\n}\n\nexport interface Course {\n  id: string;\n  name: string;\n  code: string;\n  programId: string;\n  target: number;\n  internalWeightage: number;\n  externalWeightage: number;\n  attainmentLevels: {\n    level3: number;\n    level2: number;\n    level1: number;\n  };\n  status: CourseStatus;\n  // ID of the teacher assigned to the course (default)\n  teacherId?: string | null;\n  // Section-specific teacher assignments\n  sectionTeacherIds?: { [sectionId: string]: string };\n}\n\nexport interface Student {\n  id: string;\n  name: string;\n  programId: string;\n  status: StudentStatus;\n  sectionId?: string | null;\n}\n\nexport interface Enrollment {\n  courseId: string;\n  studentId: string;\n  sectionId?: string | null;\n}\n\nexport interface Section {\n  id: string;\n  name: string;\n  programId: string;\n  batchId: string;\n}\n\nexport interface CourseOutcome {\n  id: string;\n  courseId: string;\n  number: string;\n  description: string;\n}\n\nexport interface ProgramOutcome {\n  id: string;\n  number: string;\n  description: string;\n  programId: string;\n}\n\nexport interface CoPoMapping {\n  courseId: string;\n  coId: string;\n  poId: string;\n  level: number;\n}\n\nexport interface AssessmentQuestion {\n  q: string;\n  coIds: string[];\n  maxMarks: number;\n}\n\nexport interface Assessment {\n  id: string;\n  sectionId: string;\n  name: string;\n  type: 'Internal' | 'External';\n  questions: AssessmentQuestion[];\n}\n\nexport interface MarkScore {\n  q: string;\n  marks: number;\n}\n\nexport interface Mark {\n  studentId: string;\n  assessmentId: string;\n  scores: MarkScore[];\n}\n\n// FIX: Added CoPoMap type for use in mapping matrix.\nexport interface CoPoMap {\n  [coId: string]: {\n    [poId: string]: number;\n  };\n}\n\n// FIX: Added StudentMark type for use in assessment details.\nexport interface StudentMark {\n  studentId: string;\n  [key: string]: string | number | 'U';\n}\n\n\nexport interface AppData {\n  users: User[];\n  colleges: { id: College; name: string }[];\n  programs: Program[];\n  batches: Batch[];\n  courses: Course[];\n  students: Student[];\n  enrollments: Enrollment[];\n  sections: Section[];\n  courseOutcomes: CourseOutcome[];\n  programOutcomes: ProgramOutcome[];\n  coPoMapping: CoPoMapping[];\n  assessments: Assessment[];\n  marks: Mark[];\n  settings: SystemSettings;\n}",
  "context/AppContext.tsx": "import React, { createContext, useState, useCallback, useMemo, ReactNode, useEffect } from 'react';\nimport { User, Program, College, AppData } from '../types';\n\ninterface AppContextType {\n  data: AppData;\n  setData: React.Dispatch<React.SetStateAction<AppData>>;\n  currentUser: User | null;\n  selectedLoginCollege: College | null;\n  selectedProgram: Program | null;\n  selectedBatch: string | null;\n  selectedCollegeId: string | null;\n  setSelectedCollegeId: React.Dispatch<React.SetStateAction<string | null>>;\n  login: (username: string, password: string, college: College) => boolean;\n  logout: () => void;\n  setProgramAndBatch: (program: Program, batch: string) => void;\n  goBackToProgramSelection: () => void;\n}\n\nexport const AppContext = createContext<AppContextType | undefined>(undefined);\n\nconst LoadedAppProvider: React.FC<{ children: ReactNode, initialData: AppData }> = ({ children, initialData }) => {\n  const [data, setData] = useState<AppData>(initialData);\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\n  const [selectedLoginCollege, setSelectedLoginCollege] = useState<College | null>(null);\n  const [selectedProgram, setSelectedProgram] = useState<Program | null>(null);\n  const [selectedBatch, setSelectedBatch] = useState<string | null>(null);\n  const [selectedCollegeId, setSelectedCollegeId] = useState<string | null>(null);\n\n  const login = useCallback((username: string, password: string, college: College) => {\n    const user = data.users.find(\n      (u) =>\n        u.username.toLowerCase() === username.toLowerCase() &&\n        u.password === password\n    );\n    if (user) {\n      setCurrentUser(user);\n      setSelectedLoginCollege(college);\n      // Reset program selection on new login for non-high-level users\n      if (user.role !== 'Admin' && user.role !== 'University' && user.role !== 'Department') {\n        setSelectedProgram(null);\n        setSelectedBatch(null);\n      }\n      return true;\n    }\n    return false;\n  }, [data.users]);\n\n  const logout = useCallback(() => {\n    setCurrentUser(null);\n    setSelectedLoginCollege(null);\n    setSelectedProgram(null);\n    setSelectedBatch(null);\n    setSelectedCollegeId(null);\n  }, []);\n\n  const setProgramAndBatch = useCallback((program: Program, batch: string) => {\n    setSelectedProgram(program);\n    setSelectedBatch(batch);\n    setSelectedCollegeId(program.collegeId);\n  }, []);\n\n  const goBackToProgramSelection = useCallback(() => {\n    setSelectedProgram(null);\n    setSelectedBatch(null);\n  }, []);\n\n  const value = useMemo(\n    () => ({\n      data,\n      setData,\n      currentUser,\n      login,\n      logout,\n      selectedLoginCollege,\n      selectedProgram,\n      selectedBatch,\n      setProgramAndBatch,\n      goBackToProgramSelection,\n      selectedCollegeId,\n      setSelectedCollegeId,\n    }),\n    [\n      data,\n      currentUser,\n      login,\n      logout,\n      selectedLoginCollege,\n      selectedProgram,\n      selectedBatch,\n      setProgramAndBatch,\n      goBackToProgramSelection,\n      selectedCollegeId,\n    ]\n  );\n\n  return <AppContext.Provider value={value}>{children}</AppContext.Provider>;\n};\n\n\nexport const AppProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  const [initialData, setInitialData] = useState<AppData | null>(null);\n\n  useEffect(() => {\n    fetch('./mockData.json')\n      .then(res => res.json())\n      .then(jsonData => {\n        setInitialData(jsonData);\n      })\n      .catch(error => console.error(\"Failed to load mock data:\", error));\n  }, []);\n\n  if (!initialData) {\n    return (\n      <div className=\"flex items-center justify-center h-screen bg-gray-100\">\n          <div className=\"text-center\">\n              <img src=\"https://d1hbpr09pwz0sk.cloudfront.net/logo_url/chitkara-university-4c35e411\" alt=\"Logo\" className=\"h-20 mx-auto mb-4 animate-pulse\" />\n              <p className=\"text-xl font-semibold text-gray-700\">Loading Portal...</p>\n          </div>\n      </div>\n    );\n  }\n\n  return <LoadedAppProvider initialData={initialData}>{children}</LoadedAppProvider>;\n};",
  "hooks/useAppContext.ts": "import { useContext } from 'react';\nimport { AppContext } from '../context/AppContext';\n\nexport const useAppContext = () => {\n  const context = useContext(AppContext);\n  if (context === undefined) {\n    throw new Error('useAppContext must be used within an AppProvider');\n  }\n  return context;\n};",
  "mockData.ts": "",
  "components/MainLayout.tsx": "import React from 'react';\nimport Sidebar from './Sidebar';\nimport Header from './Header';\n\ninterface MainLayoutProps {\n  children: React.ReactNode;\n}\n\nconst MainLayout: React.FC<MainLayoutProps> = ({ children }) => {\n  return (\n    <div className=\"flex h-full bg-gray-100 font-sans\">\n      <Sidebar />\n      <main className=\"flex-1 flex flex-col overflow-hidden\">\n        <Header />\n        <div className=\"flex-1 overflow-x-hidden overflow-y-auto p-4 sm:p-6 lg:p-8\">\n            {children}\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default MainLayout;",
  "components/Sidebar.tsx": "import React, { useMemo } from 'react';\nimport { NavLink, useNavigate } from 'react-router-dom';\nimport { useAppContext } from '../hooks/useAppContext';\nimport {\n    PieChart, BookOpen, Users, Target, Settings, Grid\n} from './Icons';\n\nconst Sidebar: React.FC = () => {\n  // FIX: Destructure selectedCollegeId and setSelectedCollegeId from context.\n  const { currentUser, data, selectedProgram, selectedBatch, setProgramAndBatch, goBackToProgramSelection, selectedCollegeId, setSelectedCollegeId } = useAppContext();\n  const navigate = useNavigate();\n\n  const isHighLevelUser = currentUser && (currentUser.role === 'Admin' || currentUser.role === 'University');\n  \n  // FIX: Removed local state for selectedCollegeId to use the one from global context.\n  // const [selectedCollegeId, setSelectedCollegeId] = useState<string>(selectedProgram?.collegeId || '');\n\n  const programsForSelectedCollege = useMemo(() => {\n    if (!selectedCollegeId) return [];\n    return data.programs.filter(p => p.collegeId === selectedCollegeId);\n  }, [data.programs, selectedCollegeId]);\n\n  const batchesForProgram = useMemo(() => {\n    if (!selectedProgram) return [];\n    return data.batches\n        .filter(b => b.programId === selectedProgram.id)\n        .sort((a, b) => b.name.localeCompare(a.name)); // Sort descending by name\n  }, [data.batches, selectedProgram]);\n\n  const handleCollegeChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    const newCollegeId = e.target.value;\n    // FIX: Use context setter to update the global state. Handle empty string value from select.\n    setSelectedCollegeId(newCollegeId || null); \n    goBackToProgramSelection(); \n    navigate('/program-selection');\n  };\n\n  const handleProgramChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    const newProgramId = e.target.value;\n    if (!newProgramId) {\n        goBackToProgramSelection();\n        navigate('/program-selection');\n        return;\n    }\n    const program = data.programs.find(p => p.id === newProgramId);\n    if (program) {\n        const programBatches = data.batches.filter(b => b.programId === program.id).sort((a,b) => b.name.localeCompare(a.name));\n        const defaultBatch = programBatches.length > 0 ? programBatches[0].name : '';\n        // FIX: setSelectedCollegeId is now handled inside setProgramAndBatch for consistency.\n        setProgramAndBatch(program, defaultBatch);\n    }\n  };\n\n  const handleBatchChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    if (selectedProgram) {\n        setProgramAndBatch(selectedProgram, e.target.value);\n    }\n  };\n\n  const allMenuItems = [\n    // Standard Links\n    { to: '/dashboard', label: 'Dashboard', icon: <PieChart />, roles: ['Teacher', 'Program Co-ordinator', 'University', 'Admin'] },\n    { to: '/courses', label: 'Courses', icon: <BookOpen />, roles: ['Teacher', 'Program Co-ordinator', 'Admin'] },\n    { to: '/students', label: 'Students', icon: <Users />, roles: ['Teacher', 'Program Co-ordinator', 'Admin'] },\n    { to: '/teachers', label: 'Teachers', icon: <Users />, roles: ['Program Co-ordinator'] },\n    { to: '/program-outcomes', label: 'Program Outcomes', icon: <Target />, roles: ['Program Co-ordinator', 'Admin'] },\n    { to: '/reports', label: 'Attainment Reports', icon: <PieChart />, roles: ['Teacher', 'Program Co-ordinator', 'University', 'Admin'] },\n\n    // Department Links\n    { to: '/department/students', label: 'Student Management', icon: <Users />, roles: ['Department'] },\n    { to: '/department/faculty', label: 'Faculty Management', icon: <Users />, roles: ['Department'] },\n    \n    // New Direct Admin Links\n    { to: '/admin/academic-structure', label: 'Academic Structure', icon: <Grid />, roles: ['Admin'] },\n    { to: '/admin/user-management', label: 'User Management', icon: <Users />, roles: ['Admin'] },\n    { to: '/admin/system-settings', label: 'System Settings', icon: <Settings />, roles: ['Admin'] },\n  ];\n  \n  const menuItems = allMenuItems.filter(item => currentUser && item.roles.includes(currentUser.role));\n\n  return (\n    <aside className=\"w-64 bg-white shadow-md flex flex-col hidden sm:flex h-full\">\n        <div className=\"flex items-center justify-center p-6 border-b flex-shrink-0\">\n           <img src=\"https://d1hbpr09pwz0sk.cloudfront.net/logo_url/chitkara-university-4c35e411\" alt=\"Chitkara University Logo\" className=\"h-10\" />\n        </div>\n\n        {isHighLevelUser && (\n            <div className=\"p-4 space-y-4 border-b flex-shrink-0\">\n                <div>\n                    <label htmlFor=\"college-select\" className=\"block text-sm font-medium text-gray-700\">College</label>\n                    {/* FIX: Use selectedCollegeId from context and handle null case. */}\n                    <select id=\"college-select\" value={selectedCollegeId || ''} onChange={handleCollegeChange} className=\"mt-1 block w-full pl-3 pr-10 py-2 text-base bg-white text-gray-900 border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md\">\n                        <option value=\"\">-- Select College --</option>\n                        {data.colleges.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}\n                    </select>\n                </div>\n                <div>\n                    <label htmlFor=\"program-select\" className=\"block text-sm font-medium text-gray-700\">Program</label>\n                    <select id=\"program-select\" value={selectedProgram?.id || ''} onChange={handleProgramChange} disabled={!selectedCollegeId} className=\"mt-1 block w-full pl-3 pr-10 py-2 text-base bg-white text-gray-900 border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md disabled:bg-gray-100\">\n                        <option value=\"\">-- Select Program --</option>\n                        {programsForSelectedCollege.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}\n                    </select>\n                </div>\n                <div>\n                    <label htmlFor=\"batch-select\" className=\"block text-sm font-medium text-gray-700\">Batch</label>\n                    <select id=\"batch-select\" value={selectedBatch || ''} onChange={handleBatchChange} disabled={!selectedProgram} className=\"mt-1 block w-full pl-3 pr-10 py-2 text-base bg-white text-gray-900 border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md disabled:bg-gray-100\">\n                        <option value=\"\">-- Select Batch --</option>\n                        {batchesForProgram.map(batch => <option key={batch.id} value={batch.name}>{batch.name}</option>)}\n                    </select>\n                </div>\n            </div>\n        )}\n\n      <nav className=\"flex-1 px-4 py-6 overflow-y-auto\">\n        {menuItems.map(item => (\n          <NavLink\n            key={item.to}\n            to={item.to}\n            className={({ isActive }) =>\n              `w-full flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200 ${\n                isActive \n                ? 'bg-blue-500 text-white shadow-lg' \n                : 'text-gray-600 hover:bg-gray-100'\n            }`}\n          >\n            {item.icon}\n            <span className=\"ml-4 font-medium\">{item.label}</span>\n          </NavLink>\n        ))}\n      </nav>\n    </aside>\n  );\n};\n\nexport default Sidebar;",
  "components/Header.tsx": "import React from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { LogOut, Grid } from './Icons';\n\nconst Header: React.FC = () => {\n    const { currentUser, selectedProgram, selectedBatch, logout, goBackToProgramSelection } = useAppContext();\n    const navigate = useNavigate();\n\n    const handleLogout = () => {\n        logout();\n        navigate('/login');\n    };\n\n    const handleGoToSelection = () => {\n        goBackToProgramSelection();\n        navigate('/program-selection');\n    };\n\n    return (\n        <header className=\"bg-white shadow-sm p-4 border-b border-gray-200\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-2xl font-bold text-gray-800\">{selectedProgram?.name || currentUser?.name}</h1>\n                    <p className=\"mt-1 text-gray-500\">\n                        {selectedBatch ? `Batch ${selectedBatch}` : (currentUser?.role || 'User')}\n                    </p>\n                </div>\n                 <div className=\"flex items-center gap-4\">\n                    <div className=\"text-right\">\n                        <p className=\"font-semibold text-gray-700\">{currentUser?.name}</p>\n                        <p className=\"text-sm text-gray-500\">{currentUser?.role}</p>\n                        <p className=\"text-xs text-gray-400\">{currentUser?.employeeId}</p>\n                    </div>\n                    { currentUser?.role !== 'Department' && (\n                        <button \n                            onClick={handleGoToSelection}\n                            title=\"Program Selection\"\n                            aria-label=\"Program Selection\"\n                            className=\"p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-colors\"\n                        >\n                            <Grid className=\"w-6 h-6\" />\n                        </button>\n                    )}\n                    <button \n                        onClick={handleLogout} \n                        title=\"Logout\"\n                        aria-label=\"Logout\"\n                        className=\"p-2 rounded-full hover:bg-red-100 text-gray-600 hover:text-red-600 transition-colors\"\n                    >\n                        <LogOut className=\"w-6 h-6\" />\n                    </button>\n                </div>\n            </div>\n        </header>\n    );\n};\n\nexport default Header;",
  "components/ExcelUploader.tsx": "import React, { useRef, useCallback } from 'react';\nimport { Upload } from './Icons';\n\ndeclare const XLSX: any;\n\n// FIX: Made component generic to support typed data parsing.\ninterface ExcelUploaderProps<T> {\n    onFileUpload: (data: T[]) => void;\n    label: string;\n    format: string;\n}\n\n// FIX: Converted to a generic function component.\nfunction ExcelUploader<T>({ onFileUpload, label, format }: ExcelUploaderProps<T>) {\n    const inputRef = useRef<HTMLInputElement>(null);\n\n    const handleFileChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n        const file = e.target.files?.[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = (event) => {\n            try {\n                if(typeof XLSX === 'undefined') {\n                    alert('Excel library (SheetJS) is not loaded. Please check your internet connection or script tag.');\n                    return;\n                }\n                const data = new Uint8Array(event.target?.result as ArrayBuffer);\n                const workbook = XLSX.read(data, { type: 'array' });\n                const sheetName = workbook.SheetNames[0];\n                const worksheet = workbook.Sheets[sheetName];\n                const json = XLSX.utils.sheet_to_json(worksheet);\n                // FIX: Cast parsed JSON to the generic type T.\n                onFileUpload(json as T[]);\n            } catch (error) {\n                console.error(\"Error parsing Excel file:\", error);\n                alert(\"Failed to parse the Excel file. Please ensure it's a valid format.\");\n            }\n        };\n        reader.readAsArrayBuffer(file);\n        if (inputRef.current) {\n            inputRef.current.value = ''; \n        }\n    }, [onFileUpload]);\n\n    return (\n        <div className=\"flex flex-col items-end\">\n            <button\n                type=\"button\"\n                onClick={() => inputRef.current?.click()}\n                className=\"px-4 py-2 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 flex items-center gap-2\"\n            >\n                <Upload className=\"w-5 h-5\" /> {label}\n            </button>\n             <input\n                type=\"file\"\n                ref={inputRef}\n                onChange={handleFileChange}\n                className=\"hidden\"\n                accept=\".xlsx, .xls, .csv\"\n            />\n            {format && <p className=\"text-xs text-gray-500 mt-1\">{format}</p>}\n        </div>\n    );\n};\n\nexport default ExcelUploader;",
  "pages/LoginScreen.tsx": "import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { College } from '../types';\n\nconst LoginScreen: React.FC = () => {\n    const { login, data, setProgramAndBatch } = useAppContext();\n    const navigate = useNavigate();\n    const [username, setUsername] = useState('');\n    const [password, setPassword] = useState('');\n    const [college, setCollege] = useState<College>(data.colleges[0]?.id || 'CUIET');\n    const [error, setError] = useState('');\n\n    const handleLogin = (e: React.FormEvent) => {\n        e.preventDefault();\n        setError('');\n        if (login(username, password, college)) {\n            navigate('/');\n        } else {\n            setError('Invalid username or password.');\n        }\n    };\n\n    const handleDeveloperLoginShortcut = () => {\n        const devUser = data.users.find(u => u.username === 'pc_ece');\n        const devProgram = devUser ? data.programs.find(p => p.id === devUser.programId) : undefined;\n\n        if (devUser && devProgram && devUser.password) {\n            if (login(devUser.username, devUser.password, 'CUIET')) {\n                setProgramAndBatch(devProgram, '2025-2029');\n                navigate('/');\n            }\n        } else {\n            console.error(\"Developer shortcut failed: Could not find user 'pc_ece' or their assigned program in mockData.\");\n        }\n    };\n\n    return (\n        <div className=\"flex flex-col items-center justify-center h-full bg-gray-100\">\n            <div className=\"w-full max-w-md p-8\">\n                <div className=\"flex justify-center mb-8\" onDoubleClick={handleDeveloperLoginShortcut}>\n                     <img src=\"https://d1hbpr09pwz0sk.cloudfront.net/logo_url/chitkara-university-4c35e411\" alt=\"Logo\" className=\"h-20\" />\n                </div>\n                <div className=\"bg-white p-8 rounded-xl shadow-2xl\">\n                    <h2 className=\"text-3xl font-bold text-center text-red-600 mb-6\">LOG IN</h2>\n                    <form className=\"space-y-6\" onSubmit={handleLogin}>\n                        <div>\n                            <label htmlFor=\"username\" className=\"text-sm font-bold text-gray-600 tracking-wide\">USERNAME</label>\n                            <input\n                                id=\"username\"\n                                type=\"text\"\n                                required\n                                value={username}\n                                onChange={(e) => setUsername(e.target.value)}\n                                className=\"w-full px-4 py-2 mt-2 text-base text-gray-900 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500\"\n                            />\n                        </div>\n                        <div>\n                            <label htmlFor=\"password-input\" className=\"text-sm font-bold text-gray-600 tracking-wide\">PASSWORD</label>\n                            <input\n                                id=\"password-input\"\n                                type=\"password\"\n                                required\n                                value={password}\n                                onChange={(e) => setPassword(e.target.value)}\n                                className=\"w-full px-4 py-2 mt-2 text-base text-gray-900 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500\"\n                            />\n                        </div>\n                         <div>\n                            <label htmlFor=\"college\" className=\"text-sm font-bold text-gray-600 tracking-wide\">COLLEGE</label>\n                            <select\n                                id=\"college\"\n                                value={college}\n                                onChange={(e) => setCollege(e.target.value as College)}\n                                className=\"w-full px-4 py-2 mt-2 text-base text-gray-900 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500\"\n                            >\n                                {data.colleges.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}\n                            </select>\n                        </div>\n\n                        {error && <p className=\"text-sm text-center text-red-600\">{error}</p>}\n                        \n                        <div>\n                            <button\n                                type=\"submit\"\n                                className=\"w-full flex justify-center bg-red-600 text-gray-100 p-3 rounded-full tracking-wide font-semibold shadow-lg cursor-pointer transition ease-in duration-300 hover:bg-red-700\"\n                            >\n                                LOGIN\n                            </button>\n                        </div>\n                    </form>\n                     <div className=\"p-4 mt-6 text-sm text-gray-600 bg-gray-50 rounded-lg\">\n                      <h4 className=\"font-semibold text-center\">Demo Logins (password: \"password\")</h4>\n                      <ul className=\"mt-2 list-disc list-inside\">\n                        <li>Username: <strong>teacher_ece1</strong> (Teacher)</li>\n                        <li>Username: <strong>pc_ece</strong> (PC)</li>\n                        <li>Username: <strong>dept_cuiet</strong> (Dept, CUIET)</li>\n                        <li>Username: <strong>dept_ccp</strong> (Dept, CCP)</li>\n                        <li>Username: <strong>dept_cbs</strong> (Dept, CBS)</li>\n                        <li>Username: <strong>university</strong></li>\n                        <li>Username: <strong>admin</strong></li>\n                      </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default LoginScreen;",
  "pages/ProgramSelectionScreen.tsx": "import React, { useState, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { Program } from '../types';\nimport BatchSelectionModal from '../components/BatchSelectionModal';\nimport { GraduationCap, LogOut } from '../components/Icons';\n\nconst ProgramSelectionScreen: React.FC = () => {\n    const { data, currentUser, selectedLoginCollege, logout } = useAppContext();\n    const navigate = useNavigate();\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [selectedProgramForBatch, setSelectedProgramForBatch] = useState<Program | null>(null);\n\n    const programs = useMemo(() => {\n        if (!currentUser) return [];\n        if (currentUser.role === 'Admin' || currentUser.role === 'University') {\n            return data.programs;\n        }\n        if (currentUser.role === 'Program Co-ordinator') {\n            if (currentUser.programId) {\n                return data.programs.filter(p => p.id === currentUser.programId);\n            }\n            return [];\n        }\n        return data.programs.filter(p => p.collegeId === selectedLoginCollege);\n    }, [data.programs, currentUser, selectedLoginCollege]);\n    \n    const handleProgramSelect = (program: Program) => {\n        setSelectedProgramForBatch(program);\n        setIsModalOpen(true);\n    };\n\n    const handleLogout = () => {\n        logout();\n        navigate('/login');\n    };\n\n    const collegeName = data.colleges.find(c => c.id === selectedLoginCollege)?.name || 'All Colleges';\n\n    return (\n        <div className=\"h-full bg-gray-100 p-8 flex flex-col\">\n            <header className=\"flex items-center justify-between mb-8 flex-shrink-0\">\n                <div className=\"flex items-center gap-4\">\n                   <img src=\"https://d1hbpr09pwz0sk.cloudfront.net/logo_url/chitkara-university-4c35e411\" alt=\"Logo\" className=\"h-12\" />\n                    <div>\n                        <h1 className=\"text-3xl font-bold text-gray-800\">Select a Program</h1>\n                        {currentUser && <p className=\"text-gray-600\">\n                           Welcome, {currentUser.name} ({currentUser.role}) | College: <strong>{collegeName}</strong>\n                        </p>}\n                    </div>\n                </div>\n                <button \n                    onClick={handleLogout} \n                    className=\"flex items-center px-4 py-2 font-medium text-gray-600 bg-white border border-gray-200 rounded-lg shadow-sm hover:bg-gray-100\"\n                >\n                    <LogOut className=\"w-5 h-5 mr-2\" />\n                    Logout\n                </button>\n            </header>\n            <div className=\"flex-grow overflow-y-auto\">\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6\">\n                    {programs.map(program => (\n                        <button \n                            key={program.id}\n                            onClick={() => handleProgramSelect(program)}\n                            className=\"bg-white p-6 rounded-xl shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer flex flex-col items-center text-center\"\n                        >\n                            <div className=\"p-4 bg-red-100 text-red-600 rounded-full mb-4\">\n                                <GraduationCap className=\"w-8 h-8\"/>\n                            </div>\n                            <h3 className=\"text-lg font-bold text-gray-800\">{program.name}</h3>\n                            <p className=\"text-sm text-gray-500\">{data.colleges.find(c => c.id === program.collegeId)?.name}</p>\n                        </button>\n                    ))}\n                </div>\n            </div>\n            {isModalOpen && selectedProgramForBatch && (\n                <BatchSelectionModal \n                    program={selectedProgramForBatch}\n                    onClose={() => setIsModalOpen(false)}\n                />\n            )}\n        </div>\n    );\n};\n\nexport default ProgramSelectionScreen;",
  "components/BatchSelectionModal.tsx": "import React, { useMemo, useState } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { Program } from '../types';\n\ninterface BatchSelectionModalProps {\n  program: Program;\n  onClose: () => void;\n}\n\nconst BatchSelectionModal: React.FC<BatchSelectionModalProps> = ({ program, onClose }) => {\n    const { data, setProgramAndBatch } = useAppContext();\n    \n    const availableBatches = useMemo(() => {\n        return data.batches\n            .filter(b => b.programId === program.id)\n            .sort((a,b) => b.name.localeCompare(a.name));\n    }, [data.batches, program.id]);\n\n    const [batch, setBatch] = useState(availableBatches.length > 0 ? availableBatches[0].name : \"\");\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!batch) {\n            alert(\"Please select a batch.\");\n            return;\n        }\n        setProgramAndBatch(program, batch);\n        onClose();\n    }\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n            <div className=\"bg-white rounded-lg shadow-xl p-8 w-full max-w-sm\">\n                <h2 className=\"text-2xl font-bold mb-2\">Select Batch</h2>\n                <p className=\"mb-6 text-gray-600\">For Program: <span className=\"font-semibold\">{program.name}</span></p>\n                {availableBatches.length > 0 ? (\n                    <form onSubmit={handleSubmit}>\n                        <label htmlFor=\"batch-select\" className=\"block text-sm font-medium text-gray-700\">Batch Year</label>\n                        <select\n                            id=\"batch-select\"\n                            value={batch}\n                            onChange={(e) => setBatch(e.target.value)}\n                            className=\"mt-1 block w-full pl-3 pr-10 py-2 text-base text-gray-900 bg-white border border-gray-300 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm rounded-md\"\n                        >\n                            {availableBatches.map(b => <option key={b.id} value={b.name}>{b.name}</option>)}\n                        </select>\n                        <div className=\"mt-6 flex justify-end gap-4\">\n                            <button type=\"button\" onClick={onClose} className=\"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300\">Cancel</button>\n                            <button type=\"submit\" className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700\">Proceed</button>\n                        </div>\n                    </form>\n                ) : (\n                    <div>\n                        <p className=\"text-center text-gray-500 bg-yellow-50 p-4 rounded-md\">\n                            No batches have been created for this program yet. Please contact an Administrator to set up batches.\n                        </p>\n                        <div className=\"mt-6 flex justify-end\">\n                             <button type=\"button\" onClick={onClose} className=\"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300\">Close</button>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default BatchSelectionModal;",
  "components/Modal.tsx": "import React from 'react';\n\ninterface ModalProps {\n  title: string;\n  onClose: () => void;\n  children: React.ReactNode;\n}\n\nconst Modal: React.FC<ModalProps> = ({ title, onClose, children }) => {\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 transition-opacity\" onClick={onClose}>\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 transform transition-all\" onClick={(e) => e.stopPropagation()}>\n        <div className=\"flex justify-between items-center p-4 border-b border-gray-200\">\n          <h3 className=\"text-xl font-semibold text-gray-800\">{title}</h3>\n          <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600\" aria-label=\"Close\">\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg>\n          </button>\n        </div>\n        <div>{children}</div>\n      </div>\n    </div>\n  );\n};\n\nexport default Modal;",
  "pages/Dashboard.tsx": "import React, { useMemo } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { useNavigate } from 'react-router-dom';\nimport { BookOpen, Users, Target, PieChart } from '../components/Icons';\nimport StatCard from '../components/StatCard';\n\nconst Dashboard: React.FC = () => {\n    const { data, selectedProgram, currentUser } = useAppContext();\n    const navigate = useNavigate();\n\n    const programCourses = useMemo(() => {\n        let courses = data.courses.filter(c => c.programId === selectedProgram?.id);\n        if (currentUser?.role === 'Teacher') {\n            courses = courses.filter(c => c.teacherId === currentUser.id);\n        }\n        return courses;\n    }, [data.courses, selectedProgram, currentUser]);\n\n    const programStudents = data.students.filter(s => s.programId === selectedProgram?.id);\n    const programPOs = data.programOutcomes.filter(po => po.programId === selectedProgram?.id);\n  \n    return (\n        <div className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n                <StatCard title={currentUser?.role === 'Teacher' ? \"My Assigned Courses\" : \"Courses in Program\"} value={programCourses.length} icon={<BookOpen />} color=\"blue\" />\n                <StatCard title=\"Students in Program\" value={programStudents.length} icon={<Users />} color=\"green\" />\n                <StatCard title=\"Program Outcomes\" value={programPOs.length} icon={<Target />} color=\"purple\" />\n                <StatCard title=\"Courses to Assess\" value={programCourses.length} icon={<PieChart />} color=\"red\" />\n            </div>\n            <div className=\"bg-white p-6 rounded-xl shadow-md\">\n                <h2 className=\"text-xl font-semibold text-gray-700 mb-4\">Quick Actions</h2>\n                <div className=\"flex flex-wrap gap-4\">\n                    <button onClick={() => navigate('/courses')} className=\"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors\">Manage Courses</button>\n                    <button onClick={() => navigate('/reports')} className=\"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors\">View Reports</button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default Dashboard;",
  "components/StatCard.tsx": "import React from 'react';\n\n// FIX: Specify that the `icon` prop must be a React element that accepts a `className`.\n// This provides more specific type information to TypeScript, resolving the error\n// with React.cloneElement below.\ninterface StatCardProps {\n  title: string;\n  value: string | number;\n  icon: React.ReactElement<{ className?: string }>;\n  color: 'blue' | 'green' | 'purple' | 'red';\n}\n\nconst colorClasses = {\n    blue: 'bg-blue-100 text-blue-600',\n    green: 'bg-green-100 text-green-600',\n    purple: 'bg-purple-100 text-purple-600',\n    red: 'bg-red-100 text-red-600',\n}\n\nconst StatCard: React.FC<StatCardProps> = ({ title, value, icon, color }) => (\n  <div className=\"bg-white p-6 rounded-xl shadow-md flex items-center\">\n    <div className={`p-4 rounded-full ${colorClasses[color]}`}>\n      {/* FIX: Replaced React.createElement with React.cloneElement to fix \"Spread types may only be created from object types\" error. */}\n      {React.cloneElement(icon, { className: 'w-6 h-6' })}\n    </div>\n    <div className=\"ml-4\">\n      <p className=\"text-gray-500\">{title}</p>\n      <p className=\"text-2xl font-bold text-gray-800\">{value}</p>\n    </div>\n  </div>\n);\n\nexport default StatCard;",
  "pages/CoursesList.tsx": "import React, { useState, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { Course, CourseStatus, Enrollment, User } from '../types';\nimport ExcelUploader from '../components/ExcelUploader';\nimport { ChevronDown, ChevronUp } from '../components/Icons';\nimport ConfirmationModal from '../components/ConfirmationModal';\n\n// Helper component for collapsible sections\nconst CollapsibleSection: React.FC<{ title: string; children: React.ReactNode; count: number }> = ({ title, children, count }) => {\n    const [isOpen, setIsOpen] = useState(false);\n    if (count === 0) return null;\n\n    return (\n        <div className=\"bg-white rounded-lg shadow-md\">\n            <button\n                className=\"w-full flex justify-between items-center p-4 text-left font-semibold text-lg text-gray-700\"\n                onClick={() => setIsOpen(!isOpen)}\n            >\n                <span>{title} ({count})</span>\n                {isOpen ? <ChevronUp className=\"w-6 h-6\" /> : <ChevronDown className=\"w-6 h-6\" />}\n            </button>\n            {isOpen && (\n                <div className=\"border-t border-gray-200\">\n                    {children}\n                </div>\n            )}\n        </div>\n    );\n};\n\nconst CoursesList: React.FC = () => {\n    const { selectedProgram, selectedBatch, data, setData, currentUser, selectedCollegeId } = useAppContext();\n    const navigate = useNavigate();\n\n    // State for course management\n    const [newCourseCode, setNewCourseCode] = useState('');\n    const [newCourseName, setNewCourseName] = useState('');\n    const [selectedCourseIds, setSelectedCourseIds] = useState<string[]>([]);\n    \n    // State for confirmation modal\n    const [confirmation, setConfirmation] = useState<{\n        isOpen: boolean;\n        title: string;\n        message: string;\n        onConfirm: () => void;\n    } | null>(null);\n\n    const isProgramCoordinator = currentUser?.role === 'Program Co-ordinator';\n    const isAdmin = currentUser?.role === 'Admin';\n    const canManageCourses = isProgramCoordinator || isAdmin;\n\n    // Filter and sort courses by status\n    const { activeCourses, futureCourses, completedCourses, teachersForPC, pageTitle } = useMemo(() => {\n        let courses: Course[];\n\n        if (isAdmin) {\n            courses = data.courses;\n            if (selectedProgram) {\n                courses = courses.filter(c => c.programId === selectedProgram.id);\n            } else if (selectedCollegeId) {\n                const programIdsInCollege = new Set(data.programs.filter(p => p.collegeId === selectedCollegeId).map(p => p.id));\n                courses = courses.filter(c => programIdsInCollege.has(c.programId));\n            }\n        } else if (currentUser?.role === 'Teacher') {\n            courses = data.courses.filter(c => \n                c.teacherId === currentUser.id || \n                (c.sectionTeacherIds && Object.values(c.sectionTeacherIds).includes(currentUser.id))\n            );\n        } else { // Program Co-ordinator\n            courses = data.courses.filter((c) => c.programId === selectedProgram?.id);\n        }\n        \n        courses = courses.sort((a, b) => a.code.localeCompare(b.code));\n\n        let teachersForPC: User[] = [];\n        if (isProgramCoordinator) {\n            const myManagedTeacherIds = new Set(data.users\n                .filter(u => u.role === 'Teacher' && u.programCoordinatorIds?.includes(currentUser.id))\n                .map(u => u.id));\n            teachersForPC = data.users.filter(u => myManagedTeacherIds.has(u.id));\n        } else if (isAdmin) {\n             teachersForPC = data.users.filter(u => u.role === 'Teacher');\n        }\n\n        const title = isAdmin\n            ? selectedProgram\n                ? `Courses for ${selectedProgram.name}`\n                : selectedCollegeId\n                    ? `Courses in ${data.colleges.find(c => c.id === selectedCollegeId)?.name}`\n                    : 'All Courses'\n            : currentUser?.role === 'Teacher'\n                ? 'My Assigned Courses'\n                : 'Courses';\n\n        return {\n            activeCourses: courses.filter(c => c.status === 'Active'),\n            futureCourses: courses.filter(c => c.status === 'Future'),\n            completedCourses: courses.filter(c => c.status === 'Completed'),\n            teachersForPC,\n            pageTitle: title\n        };\n    }, [data, selectedProgram, currentUser, selectedCollegeId, isProgramCoordinator, isAdmin]);\n    \n    const canAddCourse = canManageCourses && (isProgramCoordinator || (isAdmin && selectedProgram));\n\n    const handleExcelUpload = (uploadedData: { code: string; name: string }[]) => {\n        if (!selectedProgram) {\n             alert(\"Please select a program before bulk uploading courses.\");\n             return;\n        }\n        const newCourses: Course[] = uploadedData.map((row, index) => ({\n            id: `c_excel_${Date.now()}_${index}`, code: row.code || 'N/A', name: row.name || 'Untitled Course',\n            programId: selectedProgram.id, target: 50, internalWeightage: 25, externalWeightage: 75,\n            attainmentLevels: { level3: 80, level2: 70, level1: 50 }, status: 'Future', teacherId: null\n        }));\n        setData(prev => ({ ...prev, courses: [...prev.courses, ...newCourses] }));\n    };\n\n    const handleAddCourse = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!newCourseCode.trim() || !newCourseName.trim() || !selectedProgram) return;\n        const newCourse: Course = {\n            id: `c_manual_${Date.now()}`, programId: selectedProgram.id, code: newCourseCode.trim(),\n            name: newCourseName.trim(), target: 50, internalWeightage: 25, externalWeightage: 75,\n            attainmentLevels: { level3: 80, level2: 70, level1: 50 }, status: 'Future', teacherId: null\n        };\n        setData(prev => ({ ...prev, courses: [...prev.courses, newCourse] }));\n        setNewCourseCode(''); setNewCourseName('');\n    };\n\n    const performStatusUpdate = (ids: string[], newStatus: CourseStatus) => {\n        setData(prev => {\n            let newEnrollments: Enrollment[] = [...prev.enrollments];\n            const updatedCourses = prev.courses.map(c => {\n                if (ids.includes(c.id)) {\n                    if (newStatus === 'Active' && c.status !== 'Active') {\n                        if (selectedProgram && selectedBatch) {\n                            const batch = prev.batches.find(b => b.programId === selectedProgram.id && b.name === selectedBatch);\n                            if (batch) {\n                                const sectionsForBatch = prev.sections.filter(s => s.batchId === batch.id);\n                                const sectionIdsForBatch = new Set(sectionsForBatch.map(s => s.id));\n                        \n                                const activeStudentsForBatch = prev.students.filter(s => \n                                    s.programId === selectedProgram.id && \n                                    s.status === 'Active' &&\n                                    s.sectionId &&\n                                    sectionIdsForBatch.has(s.sectionId)\n                                );\n                        \n                                const existingEnrollments = new Set(newEnrollments.filter(e => e.courseId === c.id).map(e => e.studentId));\n                                \n                                const enrollmentsToAdd = activeStudentsForBatch\n                                    .filter(s => !existingEnrollments.has(s.id))\n                                    .map(s => ({ courseId: c.id, studentId: s.id, sectionId: s.sectionId }));\n                                    \n                                newEnrollments.push(...enrollmentsToAdd);\n                            }\n                        }\n                    }\n                    return { ...c, status: newStatus };\n                }\n                return c;\n            });\n            return { ...prev, courses: updatedCourses, enrollments: newEnrollments };\n        });\n        setSelectedCourseIds([]);\n        setConfirmation(null);\n    };\n\n    const promptStatusChange = (ids: string[], newStatus: CourseStatus) => {\n        let message = '';\n        if (ids.length === 1) {\n            const courseName = data.courses.find(c => c.id === ids[0])?.name;\n            message = `Are you sure you want to mark '${courseName}' as ${newStatus}?`;\n        } else {\n            message = `Are you sure you want to mark ${ids.length} selected courses as ${newStatus}?`;\n        }\n        if (newStatus === 'Active') {\n            if (!selectedBatch) {\n                alert(\"Please select a batch from the sidebar before activating a course.\");\n                return;\n            }\n            message += ` This will enroll all active students from the ${selectedBatch} batch into the course.`;\n        }\n        setConfirmation({\n            isOpen: true, title: 'Confirm Status Change', message,\n            onConfirm: () => performStatusUpdate(ids, newStatus),\n        });\n    };\n    \n    const performTeacherAssignment = (courseId: string, teacherId: string) => {\n        setData(prev => ({\n            ...prev,\n            courses: prev.courses.map(c => \n                c.id === courseId ? { ...c, teacherId: teacherId || null } : c\n            )\n        }));\n        setConfirmation(null);\n    };\n\n    const handleAssignTeacherChange = (courseId: string, newTeacherId: string) => {\n        const course = data.courses.find(c => c.id === courseId);\n        if (!course) return;\n\n        if (course.teacherId && course.teacherId !== newTeacherId) {\n             setConfirmation({\n                isOpen: true,\n                title: 'Confirm Teacher Reassignment',\n                message: \"Changing the assigned teacher will unassign the course from the previous teacher. Are you sure you want to proceed?\",\n                onConfirm: () => performTeacherAssignment(courseId, newTeacherId),\n            });\n        } else {\n            performTeacherAssignment(courseId, newTeacherId);\n        }\n    };\n\n    // Selection handlers\n    const handleToggleSelection = (courseId: string) => {\n        setSelectedCourseIds(prev =>\n            prev.includes(courseId) ? prev.filter(id => id !== courseId) : [...prev, courseId]\n        );\n    };\n    \n    const handleToggleSelectAll = (courseIds: string[]) => {\n        const allSelected = courseIds.every(id => selectedCourseIds.includes(id));\n        if (allSelected) {\n            setSelectedCourseIds(prev => prev.filter(id => !courseIds.includes(id)));\n        } else {\n            setSelectedCourseIds(prev => [...new Set([...prev, ...courseIds])]);\n        }\n    };\n\n    const renderCourseTable = (courses: Course[]) => {\n        const courseIds = courses.map(c => c.id);\n        const areAllSelected = courseIds.length > 0 && courseIds.every(id => selectedCourseIds.includes(id));\n\n        return (\n            <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full\">\n                    <thead className=\"bg-gray-50\">\n                        <tr>\n                            {canManageCourses && <th className=\"p-4 text-left\"><input type=\"checkbox\" checked={areAllSelected} onChange={() => handleToggleSelectAll(courseIds)} className=\"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\" /></th>}\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Course Code</th>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Course Name</th>\n                            {(isProgramCoordinator || isAdmin) && <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Assigned Teacher</th>}\n                            {canManageCourses && <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>}\n                            <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                        </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-gray-200\">\n                        {courses.map((course) => (\n                            <tr key={course.id} className={`hover:bg-gray-50 ${selectedCourseIds.includes(course.id) ? 'bg-indigo-50' : ''}`}>\n                                {canManageCourses && <td className=\"p-4\"><input type=\"checkbox\" checked={selectedCourseIds.includes(course.id)} onChange={() => handleToggleSelection(course.id)} className=\"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\" /></td>}\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{course.code}</td>\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">{course.name}</td>\n                                {(isProgramCoordinator || isAdmin) && (\n                                     <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                                         <select\n                                             value={course.teacherId || ''}\n                                             onChange={(e) => handleAssignTeacherChange(course.id, e.target.value)}\n                                             className=\"p-2 border bg-white text-gray-900 border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                                         >\n                                             <option value=\"\">-- Unassigned --</option>\n                                             {teachersForPC.map(teacher => (\n                                                 <option key={teacher.id} value={teacher.id}>{teacher.name}</option>\n                                             ))}\n                                         </select>\n                                     </td>\n                                )}\n                                {canManageCourses && (\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\n                                        <select value={course.status} onChange={(e) => promptStatusChange([course.id], e.target.value as CourseStatus)} className=\"p-2 border bg-white text-gray-900 border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\">\n                                            <option value=\"Future\">Future</option>\n                                            <option value=\"Active\">Active</option>\n                                            <option value=\"Completed\">Completed</option>\n                                        </select>\n                                    </td>\n                                )}\n                                <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                                    <button onClick={() => navigate(`/courses/${course.id}`)} className=\"text-indigo-600 hover:text-indigo-800\">Manage</button>\n                                </td>\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n            </div>\n        );\n    };\n\n    if (currentUser?.role === 'Teacher') {\n        return (\n           <div className=\"space-y-8\">\n              <h1 className=\"text-3xl font-bold text-gray-800\">{pageTitle}</h1>\n              <div className=\"bg-white rounded-lg shadow-md\">\n                <h2 className=\"text-xl font-bold text-gray-800 p-4 border-b\">Active Courses ({activeCourses.length})</h2>\n                {renderCourseTable(activeCourses)}\n              </div>\n              <CollapsibleSection title=\"Completed Courses\" count={completedCourses.length}>\n                  {renderCourseTable(completedCourses)}\n              </CollapsibleSection>\n              <CollapsibleSection title=\"Future Courses\" count={futureCourses.length}>\n                  {renderCourseTable(futureCourses)}\n              </CollapsibleSection>\n           </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <h1 className=\"text-3xl font-bold text-gray-800\">{pageTitle}</h1>\n                {canAddCourse && (<ExcelUploader<{ code: string; name: string }> onFileUpload={handleExcelUpload} label=\"Bulk Upload\" format=\"cols: code, name\" />)}\n            </div>\n\n            {canAddCourse && (\n                <div className=\"bg-white p-4 rounded-lg shadow-md\">\n                    <form onSubmit={handleAddCourse} className=\"flex flex-wrap md:flex-nowrap gap-4 items-end\">\n                        <div className=\"flex-grow\"><label htmlFor=\"new-course-code\" className=\"text-sm font-medium text-gray-600 block\">Course Code</label><input id=\"new-course-code\" type=\"text\" placeholder=\"e.g. CS101\" value={newCourseCode} onChange={e => setNewCourseCode(e.target.value)} className=\"w-full p-2 mt-1 border border-gray-300 rounded-md bg-white text-gray-900\" required /></div>\n                        <div className=\"flex-grow-[2]\"><label htmlFor=\"new-course-name\" className=\"text-sm font-medium text-gray-600 block\">Course Name</label><input id=\"new-course-name\" type=\"text\" placeholder=\"e.g. Intro to Programming\" value={newCourseName} onChange={e => setNewCourseName(e.target.value)} className=\"w-full p-2 mt-1 border border-gray-300 rounded-md bg-white text-gray-900\" required /></div>\n                        <button type=\"submit\" className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg h-[42px] w-full md:w-auto\">Add Course</button>\n                    </form>\n                </div>\n            )}\n            \n            {selectedCourseIds.length > 0 && (\n                <div className=\"bg-gray-800 text-white p-4 rounded-lg shadow-lg flex items-center justify-between sticky top-2 z-10\">\n                    <span className=\"font-semibold\">{selectedCourseIds.length} course(s) selected</span>\n                    <div className=\"flex gap-2\">\n                        <button onClick={() => promptStatusChange(selectedCourseIds, 'Future')} className=\"bg-gray-600 hover:bg-gray-500 text-white font-bold py-1 px-3 rounded-lg text-sm\">Mark as Future</button>\n                        <button onClick={() => promptStatusChange(selectedCourseIds, 'Active')} className=\"bg-blue-600 hover:bg-blue-500 text-white font-bold py-1 px-3 rounded-lg text-sm\">Mark as Active</button>\n                        <button onClick={() => promptStatusChange(selectedCourseIds, 'Completed')} className=\"bg-green-600 hover:bg-green-500 text-white font-bold py-1 px-3 rounded-lg text-sm\">Mark as Completed</button>\n                    </div>\n                </div>\n            )}\n\n            <div className=\"bg-white rounded-lg shadow-md\">\n                <h2 className=\"text-xl font-bold text-gray-800 p-4 border-b\">Active Courses ({activeCourses.length})</h2>\n                {renderCourseTable(activeCourses)}\n            </div>\n\n            <CollapsibleSection title=\"Future Courses\" count={futureCourses.length}>\n                {renderCourseTable(futureCourses)}\n            </CollapsibleSection>\n\n            <CollapsibleSection title=\"Completed Courses\" count={completedCourses.length}>\n                {renderCourseTable(completedCourses)}\n            </CollapsibleSection>\n\n            {confirmation && (\n                <ConfirmationModal \n                    isOpen={confirmation.isOpen}\n                    title={confirmation.title}\n                    message={confirmation.message}\n                    onConfirm={confirmation.onConfirm}\n                    onClose={() => setConfirmation(null)}\n                />\n            )}\n        </div>\n    );\n};\n\nexport default CoursesList;",
  "pages/CourseDetail.tsx": "import React, { useState, useMemo } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useAppContext } from '../hooks/useAppContext';\nimport ManageCourseOutcomes from '../components/ManageCourseOutcomes';\nimport ManageCourseAssessments from '../components/ManageCourseAssessments';\nimport CoPoMappingMatrix from '../components/CoPoMappingMatrix';\nimport CourseOverviewTab from '../components/CourseOverviewTab';\nimport StudentCOAttainmentReport from './StudentCOAttainmentReport';\nimport CourseFacultyAssignment from '../components/CourseFacultyAssignment';\nimport CourseCoAttainment from '../components/CourseCoAttainment';\nimport { Course } from '../types';\n\ntype Tab = 'Overview' | 'COs' | 'Assessments' | 'CO-PO Mapping' | 'CO Attainments' | 'Student Reports' | 'Faculty Assignment';\n\nconst CourseDetail: React.FC = () => {\n  const { courseId } = useParams<{ courseId: string }>();\n  const { data, currentUser } = useAppContext();\n  const [activeTab, setActiveTab] = useState<Tab>('Overview');\n\n  const course = useMemo(() => data.courses.find(c => c.id === courseId), [courseId, data.courses]);\n  \n  if (currentUser?.role === 'Teacher' && course && course.teacherId !== currentUser.id && (!course.sectionTeacherIds || !Object.values(course.sectionTeacherIds).includes(currentUser.id))) {\n    return (\n        <div className=\"text-center p-8 bg-white rounded-lg shadow-md\">\n            <h1 className=\"text-2xl font-bold text-red-600\">Access Denied</h1>\n            <p className=\"text-gray-500 mt-2\">You are not assigned to this course.</p>\n        </div>\n    );\n  }\n\n  if (!course) {\n    return <div className=\"text-center text-red-500 p-8\">Course not found.</div>;\n  }\n\n  const isCoordinator = currentUser?.role === 'Program Co-ordinator';\n  const isAdmin = currentUser?.role === 'Admin';\n\n  const tabs: Tab[] = ['Overview', 'COs', 'Assessments', 'CO-PO Mapping', 'CO Attainments'];\n\n  if (isCoordinator || isAdmin) {\n    tabs.push('Faculty Assignment');\n  }\n  \n  tabs.push('Student Reports');\n\n\n  const renderContent = () => {\n    switch (activeTab) {\n      case 'Overview':\n        return <CourseOverviewTab course={course} />;\n      case 'COs':\n        return <ManageCourseOutcomes />;\n      case 'Assessments':\n        return <ManageCourseAssessments course={course} />;\n      case 'CO-PO Mapping':\n        return <CoPoMappingMatrix />;\n      case 'CO Attainments':\n        return <CourseCoAttainment course={course} />;\n      case 'Faculty Assignment':\n        return (isCoordinator || isAdmin) ? <CourseFacultyAssignment course={course} /> : null;\n      case 'Student Reports':\n        return <StudentCOAttainmentReport />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-800\">{course.name} ({course.code})</h1>\n          <p className=\"text-gray-500\">Manage course details, outcomes, and assessments.</p>\n        </div>\n      </div>\n\n      <div className=\"border-b border-gray-200\">\n        <nav className=\"-mb-px flex space-x-8 overflow-x-auto\" aria-label=\"Tabs\">\n          {tabs.map(tab => (\n            <button\n              key={tab}\n              onClick={() => setActiveTab(tab)}\n              className={`${ \n                activeTab === tab\n                  ? 'border-indigo-500 text-indigo-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              } whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors`}\n            >\n              {tab}\n            </button>\n          ))}\n        </nav>\n      </div>\n      \n      <div className=\"bg-white p-6 rounded-lg shadow-md min-h-[400px]\">\n        {renderContent()}\n      </div>\n    </div>\n  );\n};\n\n\nexport default CourseDetail;",
  "components/ManageCourseOutcomes.tsx": "import React, { useState, useMemo, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { CourseOutcome } from '../types';\nimport { useAppContext } from '../hooks/useAppContext';\nimport ExcelUploader from './ExcelUploader';\nimport SaveBar from './SaveBar';\n\nconst ManageCourseOutcomes: React.FC = () => {\n  const { courseId } = useParams<{ courseId: string }>();\n  const { data, setData, currentUser } = useAppContext();\n\n  const [draftOutcomes, setDraftOutcomes] = useState<CourseOutcome[]>([]);\n  const [initialOutcomes, setInitialOutcomes] = useState<CourseOutcome[]>([]);\n\n  useEffect(() => {\n    if (!courseId) return;\n    const outcomesForCourse = data.courseOutcomes.filter(co => co.courseId === courseId);\n    setDraftOutcomes(outcomesForCourse);\n    setInitialOutcomes(outcomesForCourse);\n  }, [data.courseOutcomes, courseId]);\n\n  const isDirty = useMemo(() => JSON.stringify(draftOutcomes) !== JSON.stringify(initialOutcomes), [draftOutcomes, initialOutcomes]);\n\n  const nextCoNumber = useMemo(() => {\n    const highestNum = draftOutcomes.reduce((max, co) => {\n      const num = parseInt(co.number.replace('CO', ''), 10);\n      return !isNaN(num) && num > max ? num : max;\n    }, 0);\n    return `CO${highestNum + 1}`;\n  }, [draftOutcomes]);\n\n  const [newCoNumber, setNewCoNumber] = useState(nextCoNumber);\n  const [newCoDescription, setNewCoDescription] = useState('');\n\n  useEffect(() => {\n    setNewCoNumber(nextCoNumber);\n  }, [nextCoNumber]);\n\n  const [editingCoId, setEditingCoId] = useState<string | null>(null);\n  const [editingText, setEditingText] = useState({ number: '', description: '' });\n\n  const canManage = currentUser?.role === 'Teacher' || currentUser?.role === 'Program Co-ordinator';\n\n  const handleExcelUpload = (uploadedData: { code: string; description: string }[]) => {\n    if (!courseId) return;\n    const newOutcomes: CourseOutcome[] = uploadedData\n      .filter(row => row.code && row.description)\n      .map((row, i) => ({\n        id: `co_excel_${Date.now()}_${i}`,\n        courseId: courseId,\n        number: row.code,\n        description: row.description\n      }));\n    \n    setDraftOutcomes(prev => [...prev, ...newOutcomes]);\n    alert(`${newOutcomes.length} COs staged for upload. Click 'Save Changes' to commit.`);\n  };\n\n  const handleAddCo = () => {\n    if (!newCoDescription.trim() || !courseId) {\n      alert(\"Please fill in the Description.\");\n      return;\n    }\n    const newCo: CourseOutcome = {\n      id: `co_manual_${Date.now()}`,\n      courseId,\n      number: newCoNumber.trim(),\n      description: newCoDescription.trim()\n    };\n\n    setDraftOutcomes(prev => [...prev, newCo]);\n    setNewCoDescription('');\n  };\n\n  const handleDeleteCo = (coId: string) => {\n    if (window.confirm(\"Are you sure you want to remove this Course Outcome? This change will be saved when you click 'Save Changes'.\")) {\n      setDraftOutcomes(prev => prev.filter(co => co.id !== coId));\n    }\n  };\n\n  const handleEditStart = (co: CourseOutcome) => {\n    setEditingCoId(co.id);\n    setEditingText({ number: co.number, description: co.description });\n  };\n\n  const handleEditCancel = () => {\n    setEditingCoId(null);\n    setEditingText({ number: '', description: '' });\n  };\n\n  const handleEditSave = () => {\n    if (!editingCoId || !editingText.number.trim() || !editingText.description.trim()) return;\n\n    setDraftOutcomes(prev => prev.map(co =>\n      co.id === editingCoId\n        ? { ...co, number: editingText.number.trim(), description: editingText.description.trim() }\n        : co\n    ));\n    \n    handleEditCancel();\n  };\n\n  const handleSave = () => {\n    if (!courseId) return;\n    setData(prev => ({\n      ...prev,\n      courseOutcomes: [\n        ...prev.courseOutcomes.filter(co => co.courseId !== courseId),\n        ...draftOutcomes\n      ]\n    }));\n    setInitialOutcomes(draftOutcomes);\n    alert(\"Course Outcomes saved successfully!\");\n  };\n  \n  const handleCancel = () => {\n    setDraftOutcomes(initialOutcomes);\n    setEditingCoId(null);\n  };\n\n  return (\n    <div className=\"space-y-6 pb-20\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-xl font-semibold text-gray-700\">Manage Course Outcomes (COs)</h2>\n        {canManage && (\n          <ExcelUploader<{ code: string; description: string }>\n            onFileUpload={handleExcelUpload}\n            label=\"Upload COs\"\n            format=\"columns: code, description\"\n          />\n        )}\n      </div>\n\n      <div className=\"overflow-x-auto border border-gray-200 rounded-lg\">\n        <table className=\"min-w-full divide-y divide-gray-200\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6\">CO Code</th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Description</th>\n              {canManage && <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6\">Actions</th>}\n            </tr>\n          </thead>\n          <tbody className=\"bg-white divide-y divide-gray-200\">\n            {draftOutcomes.map(co => (\n              <tr key={co.id}>\n                {editingCoId === co.id ? (\n                  <>\n                    <td className=\"px-6 py-4\">\n                      <input\n                        type=\"text\"\n                        value={editingText.number}\n                        onChange={(e) => setEditingText({ ...editingText, number: e.target.value })}\n                        className=\"w-full p-2 border border-gray-300 rounded-md\"\n                      />\n                    </td>\n                    <td className=\"px-6 py-4\">\n                      <input\n                        type=\"text\"\n                        value={editingText.description}\n                        onChange={(e) => setEditingText({ ...editingText, description: e.target.value })}\n                        className=\"w-full p-2 border border-gray-300 rounded-md\"\n                      />\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                      <button onClick={handleEditSave} className=\"text-green-600 hover:text-green-800 mr-4\">Apply</button>\n                      <button onClick={handleEditCancel} className=\"text-gray-600 hover:text-gray-800\">Cancel</button>\n                    </td>\n                  </>\n                ) : (\n                  <>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{co.number}</td>\n                    <td className=\"px-6 py-4 whitespace-normal text-sm text-gray-600\">{co.description}</td>\n                    {canManage && (\n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                        <button onClick={() => handleEditStart(co)} className=\"text-indigo-600 hover:text-indigo-800 mr-4\">Edit</button>\n                        <button onClick={() => handleDeleteCo(co.id)} className=\"text-red-600 hover:text-red-800\">Delete</button>\n                      </td>\n                    )}\n                  </>\n                )}\n              </tr>\n            ))}\n            {canManage && editingCoId === null && (\n              <tr className=\"bg-gray-50/50\">\n                <td className=\"px-6 py-4\">\n                  <input\n                    type=\"text\"\n                    value={newCoNumber}\n                    readOnly\n                    className=\"w-full p-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500 cursor-not-allowed focus:ring-0 focus:border-gray-300\"\n                  />\n                </td>\n                <td className=\"px-6 py-4\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Description Input\"\n                    value={newCoDescription}\n                    onChange={(e) => setNewCoDescription(e.target.value)}\n                    className=\"w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 placeholder-gray-400 focus:ring-indigo-500 focus:border-indigo-500\"\n                  />\n                </td>\n                <td className=\"px-6 py-4 text-right\">\n                  <button onClick={handleAddCo} className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg\">\n                    Add\n                  </button>\n                </td>\n              </tr>\n            )}\n          </tbody>\n        </table>\n      </div>\n      <SaveBar isDirty={isDirty} onSave={handleSave} onCancel={handleCancel} />\n    </div>\n  );\n};\n\nexport default ManageCourseOutcomes;",
  "components/ManageCourseAssessments.tsx": "import React, { useState, useMemo, useEffect } from 'react';\nimport { Course } from '../types';\nimport { useAppContext } from '../hooks/useAppContext';\nimport AssessmentDetails from './AssessmentDetails';\nimport CreateAssessmentModal from './CreateAssessmentModal';\n\ninterface ManageCourseAssessmentsProps {\n  course: Course;\n}\n\nconst ManageCourseAssessments: React.FC<ManageCourseAssessmentsProps> = ({ course }) => {\n  const { data, setData, currentUser } = useAppContext();\n  const [selectedAssessmentId, setSelectedAssessmentId] = useState<string | null>(null);\n  const [selectedSectionId, setSelectedSectionId] = useState<string | null>(null);\n  const [isCreateModalOpen, setCreateModalOpen] = useState(false);\n\n  const isPC = currentUser?.role === 'Program Co-ordinator' || currentUser?.role === 'Admin';\n\n  const sectionsForDropdown = useMemo(() => {\n    // Find all sections that have students enrolled in this course\n    const enrolledSectionIds = new Set(data.enrollments.filter(e => e.courseId === course.id && e.sectionId).map(e => e.sectionId));\n    const allCourseSections = data.sections.filter(s => enrolledSectionIds.has(s.id));\n\n    if (isPC) {\n        return allCourseSections;\n    }\n    \n    if (!currentUser || currentUser.role !== 'Teacher') return [];\n    \n    // Find sections explicitly assigned to this teacher for this course\n    const teacherSectionIds = Object.entries(course.sectionTeacherIds || {})\n        .filter(([, teacherId]) => teacherId === currentUser.id)\n        .map(([sectionId]) => sectionId);\n\n    if (teacherSectionIds.length > 0) {\n        // If teacher has specific section assignments, show only those\n        return allCourseSections.filter(s => teacherSectionIds.includes(s.id));\n    }\n    \n    // If no specific section assignments, but is the main course teacher, show all sections\n    if (course.teacherId === currentUser.id) {\n        return allCourseSections; \n    }\n\n    // Otherwise, teacher has no access\n    return [];\n  }, [data.enrollments, data.sections, course, currentUser, isPC]);\n\n  // Effect to auto-select the first section if none is selected\n  useEffect(() => {\n    if (sectionsForDropdown.length > 0 && !sectionsForDropdown.some(s => s.id === selectedSectionId)) {\n        setSelectedSectionId(sectionsForDropdown[0].id);\n    } else if (sectionsForDropdown.length === 0) {\n        setSelectedSectionId(null);\n    }\n  }, [sectionsForDropdown, selectedSectionId]);\n\n  // When section changes, go back to the list view from the details view\n  useEffect(() => {\n    setSelectedAssessmentId(null);\n  }, [selectedSectionId]);\n\n  const assessments = useMemo(() => {\n    if (!selectedSectionId) return [];\n    return data.assessments.filter(a => a.sectionId === selectedSectionId);\n  }, [data.assessments, selectedSectionId]);\n\n  const handleDeleteAssessment = (assessmentId: string) => {\n    if (window.confirm(\"Are you sure you want to delete this assessment and all its questions and marks? This action cannot be undone.\")) {\n      setData(prev => ({\n        ...prev,\n        assessments: prev.assessments.filter(a => a.id !== assessmentId),\n        marks: prev.marks.filter(m => m.assessmentId !== assessmentId)\n      }));\n    }\n  }\n  \n  const sectionName = sectionsForDropdown.find(s => s.id === selectedSectionId)?.name || '';\n\n  // This dropdown will be visible in both list and detail view for PCs\n  const SectionSelector = (\n    <div className=\"mb-6 pb-4 border-b\">\n        <label htmlFor=\"section-select\" className=\"block text-sm font-medium text-gray-700\">Select Section</label>\n        <select\n            id=\"section-select\"\n            value={selectedSectionId || ''}\n            onChange={(e) => setSelectedSectionId(e.target.value)}\n            disabled={sectionsForDropdown.length === 0}\n            className=\"mt-1 block w-full max-w-sm pl-3 pr-10 py-2 text-base bg-white text-gray-900 border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md disabled:bg-gray-100\"\n        >\n            {sectionsForDropdown.map(section => (\n                <option key={section.id} value={section.id}>Section {section.name}</option>\n            ))}\n        </select>\n        {sectionsForDropdown.length === 0 && <p className=\"mt-2 text-sm text-gray-500\">You are not assigned to any sections for this course, or no sections have been created.</p>}\n    </div>\n  );\n\n  // If an assessment is selected, show details. The section selector will be shown above for PCs.\n  if (selectedAssessmentId) {\n    return (\n        <div className=\"space-y-6\">\n            {isPC && SectionSelector}\n            <AssessmentDetails \n                assessmentId={selectedAssessmentId} \n                onBack={() => setSelectedAssessmentId(null)}\n                course={course} // Pass the course down\n            />\n        </div>\n    );\n  }\n\n  // Otherwise, show the list of assessments for the selected section.\n  return (\n    <div className=\"space-y-6\">\n      {SectionSelector}\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-xl font-semibold text-gray-700\">\n            {selectedSectionId ? `Assessments for Section ${sectionName}` : 'Select a section to view assessments'}\n        </h2>\n        {(isPC || sectionsForDropdown.length > 0) && (\n          <button \n            onClick={() => setCreateModalOpen(true)} \n            className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg disabled:bg-indigo-300 disabled:cursor-not-allowed\"\n            disabled={!selectedSectionId}\n            title={!selectedSectionId ? \"Please select a section first\" : \"Create a new assessment\"}\n          >\n            Create Assessment\n          </button>\n        )}\n      </div>\n      \n      <div className=\"space-y-4\">\n        {assessments.map(assessment => {\n          const totalMaxMarks = assessment.questions.reduce((sum, q) => sum + q.maxMarks, 0);\n          const hasMarks = data.marks.some(m => m.assessmentId === assessment.id);\n          return (\n            <div key={assessment.id} className=\"bg-gray-50 p-4 rounded-lg flex justify-between items-center border border-gray-200\">\n              <div>\n                <p className=\"font-semibold text-gray-800 flex items-center\">\n                  {assessment.name}\n                  {hasMarks && (\n                    <span className=\"ml-2 text-xs font-semibold bg-green-100 text-green-800 px-2 py-0.5 rounded-full\">\n                       Marks Uploaded\n                    </span>\n                  )}\n                </p>\n                <p className=\"text-sm text-gray-500\">{assessment.type} | Max Marks: {totalMaxMarks}</p>\n              </div>\n              <div className=\"space-x-4\">\n                <button \n                  onClick={() => setSelectedAssessmentId(assessment.id)}\n                  className=\"text-indigo-600 hover:text-indigo-800 font-semibold\"\n                >\n                  Manage Questions\n                </button>\n                {isPC && (\n                   <button onClick={() => handleDeleteAssessment(assessment.id)} className=\"text-red-600 hover:text-red-800 font-semibold\">\n                      Delete\n                  </button>\n                )}\n              </div>\n            </div>\n          )\n        })}\n        {assessments.length === 0 && selectedSectionId && <p className=\"text-gray-500 text-center py-4\">No assessments found for this section.</p>}\n      </div>\n      {isCreateModalOpen && selectedSectionId && (\n        <CreateAssessmentModal sectionId={selectedSectionId} onClose={() => setCreateModalOpen(false)} />\n      )}\n    </div>\n  );\n};\n\nexport default ManageCourseAssessments;",
  "components/AssessmentDetails.tsx": "import React, { useState, useMemo, useEffect } from 'react';\nimport { Assessment, AssessmentQuestion, Mark, MarkScore, Course } from '../types';\nimport { useAppContext } from '../hooks/useAppContext';\nimport ExcelUploader from './ExcelUploader';\nimport { PlusCircle, Trash2, Download, ChevronUp, Edit } from './Icons';\nimport SaveBar from './SaveBar';\nimport ConfirmationModal from './ConfirmationModal';\n\ndeclare const XLSX: any;\n\ninterface AssessmentDetailsProps {\n  assessmentId: string;\n  onBack: () => void;\n  course: Course;\n}\n\nconst AssessmentDetails: React.FC<AssessmentDetailsProps> = ({ assessmentId, onBack, course }) => {\n    const { data, setData, currentUser } = useAppContext();\n    const canManage = currentUser?.role === 'Teacher' || currentUser?.role === 'Program Co-ordinator';\n    \n    const [confirmation, setConfirmation] = useState<{\n        isOpen: boolean;\n        title: string;\n        message: string;\n        onConfirm: () => void;\n    } | null>(null);\n\n    const assessment = useMemo(() => data.assessments.find(a => a.id === assessmentId), [data.assessments, assessmentId]);\n\n    const [draftQuestions, setDraftQuestions] = useState<AssessmentQuestion[]>([]);\n    const [initialQuestions, setInitialQuestions] = useState<AssessmentQuestion[]>([]);\n    const [editingQuestion, setEditingQuestion] = useState<{ originalQ: string; name: string; maxMarks: number } | null>(null);\n\n    useEffect(() => {\n        if (assessment) {\n            setDraftQuestions(assessment.questions);\n            setInitialQuestions(assessment.questions);\n        }\n    }, [assessment]);\n\n    const isDirty = useMemo(() => JSON.stringify(initialQuestions) !== JSON.stringify(draftQuestions), [initialQuestions, draftQuestions]);\n\n    const nextQName = useMemo(() => {\n        if (!draftQuestions) return 'Q1';\n        const highestNum = draftQuestions.reduce((max, q) => {\n            const num = parseInt(q.q.replace('Q', ''), 10);\n            return !isNaN(num) && num > max ? num : max;\n        }, 0);\n        return `Q${highestNum + 1}`;\n    }, [draftQuestions]);\n    \n    const [newQName, setNewQName] = useState(nextQName);\n    const [newQMaxMarks, setNewQMaxMarks] = useState(10);\n    \n    useEffect(() => {\n        setNewQName(nextQName);\n    }, [nextQName]);\n    \n    if (!assessment || !course) {\n        return (\n            <div>\n                <p className=\"text-red-500\">Assessment or associated course not found.</p>\n                <button onClick={onBack} className=\"mt-4 flex items-center text-indigo-600 hover:text-indigo-800\">\n                    <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M10 19l-7-7m0 0l7-7m-7 7h18\"></path></svg>\n                    Back to Assessments\n                </button>\n            </div>\n        );\n    }\n    \n    const courseOutcomes = data.courseOutcomes.filter(co => co.courseId === course.id);\n\n    const handleDownloadTemplate = () => {\n        const studentIdsForSection = new Set(\n            data.enrollments\n                .filter(e => e.sectionId === assessment.sectionId)\n                .map(e => e.studentId)\n        );\n\n        const activeEnrolledStudents = data.students\n            .filter(s => s.status === 'Active' && studentIdsForSection.has(s.id))\n            .sort((a, b) => a.id.localeCompare(b.id));\n\n        const questionHeaders = draftQuestions.map(q => q.q).sort((a, b) => parseInt(a.substring(1)) - parseInt(b.substring(1)));\n\n        const templateData = activeEnrolledStudents.map(student => {\n            const studentRow: { [key: string]: string | number } = { 'Student ID': student.id, 'Student Name': student.name };\n            questionHeaders.forEach(header => { studentRow[header] = ''; });\n            return studentRow;\n        });\n        \n        if (templateData.length === 0) {\n            const headerRow: { [key: string]: string } = { 'Student ID': '', 'Student Name': '' };\n            questionHeaders.forEach(header => { headerRow[header] = ''; });\n            templateData.push(headerRow);\n            alert(\"No active students found in this section. A template with only headers will be downloaded.\");\n        }\n\n        try {\n            if (typeof XLSX === 'undefined') { alert('Excel library (SheetJS) is not loaded.'); return; }\n            const worksheet = XLSX.utils.json_to_sheet(templateData);\n            const workbook = XLSX.utils.book_new();\n            XLSX.utils.book_append_sheet(workbook, worksheet, 'Marks Template');\n            const fileName = `Marks-Template-${course?.code || 'Course'}-${assessment.name}.xlsx`.replace(/\\s+/g, '_');\n            XLSX.writeFile(workbook, fileName);\n        } catch (error) {\n            console.error(\"Error generating Excel template:\", error);\n            alert(\"Failed to generate the Excel template.\");\n        }\n    };\n\n    const handleQuestionsUpload = (uploadedData: { q: string; maxMarks: string | number }[]) => {\n      const newQuestions: AssessmentQuestion[] = uploadedData\n          .filter(row => row.q && row.maxMarks && !isNaN(Number(row.maxMarks)) && Number(row.maxMarks) > 0)\n          .map(row => ({ q: String(row.q).trim(), maxMarks: Number(row.maxMarks), coIds: [] }));\n\n      if (newQuestions.length === 0) {\n          alert(\"No valid questions found in file. Ensure it has 'q' and 'maxMarks' columns with valid data.\");\n          return;\n      }\n\n      setDraftQuestions(prevDraft => {\n        const existingQNames = new Set(prevDraft.map(q => q.q.toLowerCase()));\n        const uniqueNewQs = newQuestions.filter(nq => !existingQNames.has(nq.q.toLowerCase()));\n        alert(`${uniqueNewQs.length} new questions staged. ${newQuestions.length - uniqueNewQs.length} duplicates ignored. Click 'Save Changes' to commit.`);\n        return [...prevDraft, ...uniqueNewQs];\n      });\n    };\n\n    const handleMarksUpload = (uploadedData: any[]) => {\n      const studentIdsInSection = new Set(data.enrollments.filter(e => e.sectionId === assessment.sectionId).map(e => e.studentId));\n\n      setData(prev => {\n          let updatedMarks = [...prev.marks];\n\n          uploadedData.forEach(row => {\n              const studentIdKey = Object.keys(row).find(key => key.toLowerCase().includes('id'));\n              if (!studentIdKey) return;\n              const studentId = String(row[studentIdKey]);\n              if (!studentId || !studentIdsInSection.has(studentId)) return;\n\n              let markEntryIndex = updatedMarks.findIndex(m => m.studentId === studentId && m.assessmentId === assessment.id);\n              let studentMarkEntry: Mark;\n              if (markEntryIndex === -1) {\n                  studentMarkEntry = { studentId, assessmentId: assessment.id, scores: [] };\n              } else {\n                  studentMarkEntry = { ...updatedMarks[markEntryIndex], scores: [...updatedMarks[markEntryIndex].scores] };\n              }\n\n              Object.keys(row).forEach(qName => {\n                  if (draftQuestions.some(q => q.q === qName)) {\n                      const markValue = row[qName];\n                      if (markValue === null || markValue === undefined || String(markValue).trim().toUpperCase() === 'U') {\n                          studentMarkEntry.scores = studentMarkEntry.scores.filter(s => s.q !== qName);\n                      } else {\n                          const score: MarkScore = { q: qName, marks: Number(markValue) };\n                          if (isNaN(score.marks)) return;\n                          \n                          const scoreIndex = studentMarkEntry.scores.findIndex(s => s.q === qName);\n                          if (scoreIndex > -1) studentMarkEntry.scores[scoreIndex] = score;\n                          else studentMarkEntry.scores.push(score);\n                      }\n                  }\n              });\n\n              if (markEntryIndex === -1) updatedMarks.push(studentMarkEntry);\n              else updatedMarks[markEntryIndex] = studentMarkEntry;\n          });\n          return { ...prev, marks: updatedMarks };\n      });\n      alert(`Marks processed for ${uploadedData.length} students.`);\n    };\n\n    const handleAddQuestion = () => {\n        if (newQMaxMarks <= 0) { alert('Max marks must be greater than 0.'); return; }\n        if (draftQuestions.some(q => q.q.toLowerCase() === newQName.trim().toLowerCase())) {\n            alert(`Question \\\"${newQName.trim()}\\\" already exists.`); return;\n        }\n        const newQuestion: AssessmentQuestion = { q: newQName.trim(), maxMarks: Number(newQMaxMarks), coIds: [] };\n        setDraftQuestions(prev => [...prev, newQuestion]);\n        setNewQMaxMarks(10);\n    };\n\n    const handleRemoveQuestion = (questionNameToDelete: string) => {\n        setConfirmation({\n            isOpen: true,\n            title: 'Delete Question',\n            message: `Are you sure you want to delete this question? All student marks for this question will also be removed. This change will be applied when you save.`,\n            onConfirm: () => {\n                setDraftQuestions(prev => prev.filter(q => q.q !== questionNameToDelete));\n                setConfirmation(null);\n            },\n        });\n    };\n    \n    const handleCoMappingChange = (qName: string, coId: string, isChecked: boolean) => {\n      setDraftQuestions(prevQs => prevQs.map(q => \n          q.q === qName ? { ...q, coIds: isChecked ? [...q.coIds, coId] : q.coIds.filter(id => id !== coId) } : q\n      ));\n    };\n\n    const handleEditStart = (q: AssessmentQuestion) => setEditingQuestion({ originalQ: q.q, name: q.q, maxMarks: q.maxMarks });\n    const handleEditCancel = () => setEditingQuestion(null);\n\n    const handleEditSave = () => {\n      if (!editingQuestion) return;\n      const { originalQ, name: newName, maxMarks } = editingQuestion;\n\n      if (maxMarks <= 0) { alert(\"Max marks must be greater than 0.\"); return; }\n      const isRenaming = newName.toLowerCase() !== originalQ.toLowerCase();\n      if (isRenaming && draftQuestions.some(q => q.q.toLowerCase() === newName.toLowerCase())) {\n        alert(`Question \\\"${newName}\\\" already exists.`); return;\n      }\n      \n      setDraftQuestions(prev => prev.map(q => q.q === originalQ ? { ...q, q: newName.trim(), maxMarks } : q));\n      setEditingQuestion(null);\n    };\n\n    const handleSave = () => {\n        setData(prev => {\n            const updatedAssessments = prev.assessments.map(a => \n                a.id === assessment.id ? { ...a, questions: draftQuestions } : a\n            );\n            \n            const oldQuestionNames = new Set(initialQuestions.map(q => q.q));\n            const newQuestionNames = new Set(draftQuestions.map(q => q.q));\n            const deletedQuestionNames = [...oldQuestionNames].filter(name => !newQuestionNames.has(name));\n\n            const updatedMarks = prev.marks.map(mark => {\n                if (mark.assessmentId === assessment.id) {\n                    const updatedScores = mark.scores.filter(score => !deletedQuestionNames.includes(score.q));\n                    return { ...mark, scores: updatedScores };\n                }\n                return mark;\n            }).filter(mark => mark.scores.length > 0 || mark.assessmentId !== assessment.id);\n\n            return { ...prev, assessments: updatedAssessments, marks: updatedMarks };\n        });\n\n        setInitialQuestions(draftQuestions);\n        alert(\"Questions and CO mappings saved!\");\n    };\n\n    const handleCancel = () => {\n        setDraftQuestions(initialQuestions);\n        setEditingQuestion(null);\n    };\n\n    return (\n        <div className=\"space-y-6 pb-20\">\n            <div className=\"flex justify-between items-center\">\n                <h2 className=\"text-2xl font-bold text-gray-800\">Manage: {assessment.name}</h2>\n                <button onClick={onBack} className=\"flex items-center px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold\">\n                    <ChevronUp className=\"w-5 h-5 mr-2\" />\n                    Back to List\n                </button>\n            </div>\n            \n            <div className=\"bg-gray-50 border border-gray-200 p-4 rounded-lg\">\n                <h3 className=\"text-lg font-semibold text-gray-700 mb-4\">Upload Student Marks</h3>\n                 <div className=\"flex items-start gap-4\">\n                    <button type=\"button\" onClick={handleDownloadTemplate} className=\"px-4 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 flex items-center gap-2\">\n                        <Download className=\"w-5 h-5\" /> Download Template\n                    </button>\n                    <ExcelUploader<any> onFileUpload={handleMarksUpload} label=\"Upload Marks\" format=\"cols: id, name, Q1, Q2...\" />\n                </div>\n            </div>\n\n            <div className=\"bg-gray-50 border border-gray-200 p-4 rounded-lg\">\n                 {canManage && (\n                    <div className=\"pb-4 mb-4 border-b border-gray-200\">\n                        <h4 className=\"text-lg font-semibold text-gray-700 mb-2\">Bulk Upload Questions</h4>\n                        <ExcelUploader<{ q: string; maxMarks: string | number }> onFileUpload={handleQuestionsUpload} label=\"Upload Questions\" format=\"columns: q, maxMarks\" />\n                    </div>\n                )}\n                <h3 className=\"text-lg font-semibold text-gray-700 mb-4\">Manage Questions & CO Mapping</h3>\n                 <div className=\"overflow-x-auto\">\n                    <table className=\"min-w-full divide-y divide-gray-200\">\n                    <thead className=\"bg-gray-100\">\n                        <tr>\n                            <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\">Question</th>\n                            <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\">Max Marks</th>\n                            {courseOutcomes.map(co => (\n                                <th key={co.id} className=\"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase\">{co.number}</th>\n                            ))}\n                            {canManage && <th className=\"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase\">Actions</th>}\n                        </tr>\n                    </thead>\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\n                        {draftQuestions.map(q => (\n                            <tr key={q.q}>\n                              {editingQuestion?.originalQ === q.q ? (\n                                <>\n                                  <td className=\"px-4 py-2\"><input type=\"text\" value={editingQuestion.name} onChange={e => setEditingQuestion({...editingQuestion, name: e.target.value})} className=\"w-full p-2 border rounded-md\" /></td>\n                                  <td className=\"px-4 py-2\"><input type=\"number\" value={editingQuestion.maxMarks} onChange={e => setEditingQuestion({...editingQuestion, maxMarks: Number(e.target.value)})} className=\"w-24 p-2 border rounded-md\" /></td>\n                                  <td colSpan={courseOutcomes.length}></td>\n                                  <td className=\"px-4 py-2 text-right whitespace-nowrap\">\n                                      <button onClick={handleEditSave} className=\"text-green-600 font-semibold mr-2\">Apply</button>\n                                      <button onClick={handleEditCancel} className=\"text-gray-600\">Cancel</button>\n                                  </td>\n                                </>\n                              ) : (\n                                <>\n                                  <td className=\"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900\">{q.q}</td>\n                                  <td className=\"px-4 py-2 whitespace-nowrap text-sm text-gray-600\">{q.maxMarks}</td>\n                                  {courseOutcomes.map(co => (\n                                      <td key={co.id} className=\"px-4 py-2 text-center\">\n                                          <input type=\"checkbox\" checked={q.coIds.includes(co.id)} onChange={(e) => canManage && handleCoMappingChange(q.q, co.id, e.target.checked)} disabled={!canManage} className=\"h-4 w-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500 disabled:opacity-50\" />\n                                      </td>\n                                  ))}\n                                  {canManage && (\n                                      <td className=\"px-4 py-2 text-right\">\n                                          <button onClick={() => handleEditStart(q)} aria-label={`Edit question ${q.q}`} className=\"text-indigo-600 hover:text-indigo-800 p-1 mr-1\"><Edit className=\"w-5 h-5\" /></button>\n                                          <button onClick={() => handleRemoveQuestion(q.q)} aria-label={`Delete question ${q.q}`} className=\"text-red-600 hover:text-red-800 p-1\"><Trash2 className=\"w-5 h-5\" /></button>\n                                      </td>\n                                  )}\n                                </>\n                              )}\n                            </tr>\n                        ))}\n                        {canManage && !editingQuestion && (\n                            <tr className=\"bg-gray-50\">\n                                <td className=\"px-4 py-2\">\n                                    <input type=\"text\" value={newQName} readOnly className=\"w-full p-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500 cursor-not-allowed focus:ring-0 focus:border-gray-300\" />\n                                </td>\n                                <td className=\"px-4 py-2\">\n                                    <input type=\"number\" value={newQMaxMarks} onChange={e => setNewQMaxMarks(Number(e.target.value))} className=\"w-24 p-2 border border-gray-300 rounded-md bg-white text-gray-900\" />\n                                </td>\n                                <td colSpan={courseOutcomes.length}></td>\n                                <td className=\"px-4 py-2 text-right\">\n                                    <button onClick={handleAddQuestion} aria-label=\"Add new question\" className=\"bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700\"><PlusCircle className=\"w-5 h-5\" /></button>\n                                </td>\n                            </tr>\n                        )}\n                    </tbody>\n                    </table>\n                </div>\n            </div>\n            <SaveBar isDirty={isDirty} onSave={handleSave} onCancel={handleCancel} />\n            {confirmation && (\n                <ConfirmationModal \n                    isOpen={confirmation.isOpen}\n                    title={confirmation.title}\n                    message={confirmation.message}\n                    onConfirm={confirmation.onConfirm}\n                    onClose={() => setConfirmation(null)}\n                />\n            )}\n        </div>\n    );\n};\n\nexport default AssessmentDetails;",
  "components/CoPoMappingMatrix.tsx": "import React, { useState, useMemo, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { CoPoMapping, CoPoMap } from '../types';\nimport { useAppContext } from '../hooks/useAppContext';\nimport SaveBar from './SaveBar';\n\n\nconst CoPoMappingMatrix: React.FC = () => {\n  const { courseId } = useParams<{ courseId: string }>();\n  const { data, setData, currentUser } = useAppContext();\n  \n  const canManage = currentUser?.role === 'Teacher' || currentUser?.role === 'Program Co-ordinator';\n\n  const { courseOutcomes, programOutcomes, initialMapArray } = useMemo(() => {\n    const course = data.courses.find(c => c.id === courseId);\n    return {\n      courseOutcomes: data.courseOutcomes.filter(co => co.courseId === courseId),\n      programOutcomes: data.programOutcomes.filter(po => po.programId === course?.programId),\n      initialMapArray: data.coPoMapping.filter(m => m.courseId === courseId),\n    };\n  }, [courseId, data]);\n  \n  const [draftMapping, setDraftMapping] = useState<CoPoMap>({});\n  const [initialMapping, setInitialMapping] = useState<CoPoMap>({});\n\n  useEffect(() => {\n    const map: CoPoMap = {};\n    for (const co of courseOutcomes) {\n      map[co.id] = {};\n    }\n    for (const m of initialMapArray) {\n      if (map[m.coId]) {\n        map[m.coId][m.poId] = m.level;\n      }\n    }\n    setDraftMapping(map);\n    setInitialMapping(map);\n  }, [courseOutcomes, initialMapArray]);\n\n  const isDirty = useMemo(() => JSON.stringify(draftMapping) !== JSON.stringify(initialMapping), [draftMapping, initialMapping]);\n\n  const handleMappingChange = (coId: string, poId: string, value: string) => {\n    const level = parseInt(value, 10);\n    if (isNaN(level) || level < 0 || level > 3) return;\n    \n    setDraftMapping(prev => ({\n      ...prev,\n      [coId]: {\n        ...prev[coId],\n        [poId]: level\n      }\n    }));\n  };\n\n  const handleSave = () => {\n    if (!courseId) return;\n    \n    const newMappingArray: CoPoMapping[] = [];\n    Object.keys(draftMapping).forEach(coId => {\n      Object.keys(draftMapping[coId]).forEach(poId => {\n        const level = draftMapping[coId][poId];\n        if (level > 0) {\n          newMappingArray.push({ courseId, coId, poId, level });\n        }\n      });\n    });\n\n    setData(prev => ({\n      ...prev,\n      coPoMapping: [\n        ...prev.coPoMapping.filter(m => m.courseId !== courseId),\n        ...newMappingArray\n      ]\n    }));\n    \n    setInitialMapping(draftMapping); // Set the new saved state as the initial state\n    alert(\"Mapping saved successfully!\");\n  };\n\n  const handleCancel = () => {\n    setDraftMapping(initialMapping);\n  };\n\n  return (\n    <div className=\"space-y-6 pb-20\">\n      <h2 className=\"text-xl font-semibold text-gray-700\">CO-PO Mapping Matrix</h2>\n      <div className=\"overflow-x-auto\">\n        <table className=\"min-w-full border-collapse border border-gray-300\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"border border-gray-300 p-2 text-xs font-medium text-gray-500 uppercase\">CO</th>\n              {programOutcomes.map(po => (\n                <th key={po.id} className=\"border border-gray-300 p-2 text-xs font-medium text-gray-500 uppercase\" title={po.description}>\n                  {po.number}\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody>\n            {courseOutcomes.map(co => (\n              <tr key={co.id} className=\"bg-white hover:bg-gray-50\">\n                <td className=\"border border-gray-300 p-2 text-sm font-medium text-gray-900\" title={co.description}>\n                  {co.number}\n                </td>\n                {programOutcomes.map(po => (\n                  <td key={po.id} className=\"border border-gray-300 p-1\">\n                    <select\n                      value={draftMapping[co.id]?.[po.id] || 0}\n                      onChange={(e) => handleMappingChange(co.id, po.id, e.target.value)}\n                      className=\"w-full bg-white text-gray-900 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100\"\n                      disabled={!canManage}\n                    >\n                      <option value=\"0\">-</option>\n                      <option value=\"1\">1</option>\n                      <option value=\"2\">2</option>\n                      <option value=\"3\">3</option>\n                    </select>\n                  </td>\n                ))}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n      \n      <SaveBar isDirty={isDirty} onSave={handleSave} onCancel={handleCancel} />\n    </div>\n  );\n};\n\nexport default CoPoMappingMatrix;",
  "pages/ProgramOutcomesList.tsx": "import React, { useState, useMemo, useEffect } from 'react';\nimport { ProgramOutcome } from '../types';\nimport ExcelUploader from '../components/ExcelUploader';\nimport { useAppContext } from '../hooks/useAppContext';\nimport POAttainmentDashboard from '../components/POAttainmentDashboard';\nimport { Trash2 } from '../components/Icons';\nimport AddProgramOutcomeModal from '../components/AddProgramOutcomeModal';\nimport SaveBar from '../components/SaveBar';\nimport CoursePoLinkageDashboard from '../components/CoursePoLinkageDashboard';\n\nconst ProgramOutcomesList: React.FC = () => {\n  const { selectedProgram, data, setData } = useAppContext();\n  const [isModalOpen, setModalOpen] = useState(false);\n  \n  const { programOutcomes, coursesForProgram } = useMemo(() => {\n    const outcomes = data.programOutcomes.filter(po => po.programId === selectedProgram?.id);\n    const courses = data.courses.filter(c => c.programId === selectedProgram?.id && c.status !== 'Future');\n    return {\n        programOutcomes: outcomes,\n        coursesForProgram: courses\n    };\n  }, [data.programOutcomes, data.courses, selectedProgram?.id]);\n\n  // State management for the dashboard\n  const [originalState, setOriginalState] = useState({ weights: { direct: 90, indirect: 10 }, indirectAttainment: {} as {[poId: string]: string} });\n  const [draftState, setDraftState] = useState(originalState);\n  \n  // Reset state if program changes\n  useEffect(() => {\n    const initialState = { weights: { direct: 90, indirect: 10 }, indirectAttainment: {} };\n    setDraftState(initialState);\n    setOriginalState(initialState);\n  }, [selectedProgram?.id]);\n\n  const isDirty = useMemo(() => JSON.stringify(originalState) !== JSON.stringify(draftState), [originalState, draftState]);\n\n  const handleSave = () => {\n    // In a real app, this would persist to a backend.\n    // Here, we'll just commit the draft state to be the new \"original\" state for this session.\n    setOriginalState(draftState);\n    alert(\"Attainment values have been saved for this session.\");\n  };\n\n  const handleCancel = () => {\n    setDraftState(originalState);\n  };\n\n  const handleExcelUpload = (uploadedData: { number: string; description: string }[]) => {\n    if (!selectedProgram) return;\n\n    const newPOs: ProgramOutcome[] = uploadedData\n      .filter(row => row.number && row.description)\n      .map((row, i) => ({\n        id: `po_excel_${Date.now()}_${i}`,\n        programId: selectedProgram.id,\n        number: row.number,\n        description: row.description\n    }));\n    \n    setData(prev => ({\n        ...prev,\n        programOutcomes: [...prev.programOutcomes, ...newPOs]\n    }));\n    alert(`${newPOs.length} POs uploaded successfully!`);\n  };\n  \n  const handleDeletePo = (poId: string) => {\n    if (window.confirm(\"Are you sure you want to delete this Program Outcome?\")) {\n        setData(prev => ({\n            ...prev,\n            programOutcomes: prev.programOutcomes.filter(po => po.id !== poId)\n        }));\n    }\n  }\n\n  return (\n    <div className=\"space-y-6 pb-20\">\n      <div className=\"flex justify-between items-start\">\n        <h1 className=\"text-3xl font-bold text-gray-800\">Program Outcomes (POs)</h1>\n        <div className=\"flex items-start gap-4\">\n            <ExcelUploader<{ number: string; description: string }>\n                onFileUpload={handleExcelUpload}\n                label=\"Upload POs\"\n                format=\"columns: number, description\"\n            />\n            <button onClick={() => setModalOpen(true)} className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg\">\n                Add New PO\n            </button>\n        </div>\n      </div>\n      \n      <div className=\"bg-white p-6 rounded-lg shadow-md\">\n        <h2 className=\"text-xl font-semibold mb-4 text-gray-700\">Current POs</h2>\n         <ul className=\"space-y-3\">\n            {programOutcomes.map(po => (\n                <li key={po.id} className=\"p-4 bg-gray-100 rounded-lg flex justify-between items-center\">\n                    <div>\n                        <span className=\"font-bold text-gray-800\">{po.number}:</span>\n                        <span className=\"ml-2 text-gray-600\">{po.description}</span>\n                    </div>\n                    <button onClick={() => handleDeletePo(po.id)} className=\"text-red-600 hover:text-red-800\">\n                        <Trash2 className=\"w-5 h-5\" />\n                    </button>\n                </li>\n            ))}\n            {programOutcomes.length === 0 && <p className=\"text-gray-500 text-center py-4\">No Program Outcomes defined for this program yet.</p>}\n        </ul>\n      </div>\n      \n      <POAttainmentDashboard \n        programOutcomes={programOutcomes}\n        draftState={draftState}\n        onStateChange={setDraftState}\n      />\n\n      <CoursePoLinkageDashboard \n        programOutcomes={programOutcomes}\n        courses={coursesForProgram}\n      />\n      \n      {isModalOpen && (\n        <AddProgramOutcomeModal onClose={() => setModalOpen(false)} />\n      )}\n      \n      <SaveBar isDirty={isDirty} onSave={handleSave} onCancel={handleCancel} />\n    </div>\n  );\n};\n\nexport default ProgramOutcomesList;",
  "components/POAttainmentDashboard.tsx": "import React, { useMemo } from 'react';\nimport { ProgramOutcome } from '../types';\n\ninterface DashboardState {\n    weights: { direct: number; indirect: number; };\n    indirectAttainment: { [poId: string]: string; };\n}\ninterface POAttainmentDashboardProps {\n  programOutcomes: ProgramOutcome[];\n  draftState: DashboardState;\n  onStateChange: (newState: DashboardState) => void;\n}\n\nconst POAttainmentDashboard: React.FC<POAttainmentDashboardProps> = ({ programOutcomes, draftState, onStateChange }) => {\n  const { weights, indirectAttainment } = draftState;\n\n  // Mock direct attainment values for demonstration\n  const directAttainment = useMemo(() => {\n    const attainment: { [poId: string]: number } = {};\n    programOutcomes.forEach(po => {\n      attainment[po.id] = parseFloat((Math.random() * (2.8 - 1.5) + 1.5).toFixed(2));\n    });\n    return attainment;\n  }, [programOutcomes]);\n  \n\n  const handleIndirectChange = (poId: string, value: string) => {\n    onStateChange({\n        ...draftState,\n        indirectAttainment: {\n            ...indirectAttainment,\n            [poId]: value\n        }\n    });\n  };\n  \n  const handleWeightChange = (type: 'direct' | 'indirect', value: string) => {\n    const numValue = parseInt(value, 10);\n    if (isNaN(numValue) || numValue < 0 || numValue > 100) {\n        return; \n    }\n\n    if (type === 'direct') {\n        onStateChange({\n            ...draftState,\n            weights: { direct: numValue, indirect: 100 - numValue }\n        });\n    } else { // type === 'indirect'\n         onStateChange({\n            ...draftState,\n            weights: { direct: 100 - numValue, indirect: numValue }\n        });\n    }\n  };\n\n  const calculateOverall = (poId: string) => {\n    const direct = directAttainment[poId] || 0;\n    \n    const indirectValue = indirectAttainment[poId];\n    const indirect = (indirectValue === undefined || indirectValue.trim() === '') \n      ? 3 \n      : parseFloat(indirectValue);\n\n    if (isNaN(indirect)) {\n        return 'Invalid';\n    }\n\n    const directWeight = weights.direct / 100;\n    const indirectWeight = weights.indirect / 100;\n    \n    return (direct * directWeight + indirect * indirectWeight).toFixed(2);\n  };\n  \n  return (\n    <div className=\"bg-white p-6 rounded-lg shadow-md\">\n      <h2 className=\"text-2xl font-bold text-gray-800 mb-6\">PO Attainment Dashboard</h2>\n      <div className=\"overflow-x-auto\">\n        <table className=\"min-w-full border-collapse border border-gray-300\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"border border-gray-300 p-2 text-sm font-medium text-gray-500 uppercase\">Attainment Type</th>\n              <th className=\"border border-gray-300 p-2 text-sm font-medium text-gray-500 uppercase\">Weightage</th>\n              {programOutcomes.map(po => (\n                <th key={po.id} className=\"border border-gray-300 p-2 text-sm font-medium text-gray-500 uppercase\">{po.number}</th>\n              ))}\n            </tr>\n          </thead>\n          <tbody>\n            <tr className=\"bg-white\">\n              <td className=\"border border-gray-300 p-2 font-semibold text-gray-700\">Direct</td>\n              <td className=\"border border-gray-300 p-1\">\n                <div className=\"flex items-center\">\n                    <input type=\"number\" value={weights.direct} onChange={e => handleWeightChange('direct', e.target.value)} className=\"w-24 p-2 bg-white text-gray-900 border border-gray-300 rounded-md text-center focus:ring-indigo-500 focus:border-indigo-500\" />\n                    <span className=\"ml-1 text-gray-700\">%</span>\n                </div>\n              </td>\n              {programOutcomes.map(po => (\n                <td key={po.id} className=\"border border-gray-300 p-2 text-center font-semibold text-green-600\">{directAttainment[po.id]}</td>\n              ))}\n            </tr>\n            <tr className=\"bg-white\">\n              <td className=\"border border-gray-300 p-2 font-semibold text-gray-700\">Indirect</td>\n               <td className=\"border border-gray-300 p-1\">\n                 <div className=\"flex items-center\">\n                    <input type=\"number\" value={weights.indirect} onChange={e => handleWeightChange('indirect', e.target.value)} className=\"w-24 p-2 bg-white text-gray-900 border border-gray-300 rounded-md text-center focus:ring-indigo-500 focus:border-indigo-500\" />\n                    <span className=\"ml-1 text-gray-700\">%</span>\n                </div>\n              </td>\n              {programOutcomes.map(po => (\n                <td key={po.id} className=\"border border-gray-300 p-1\">\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    className=\"w-24 p-2 bg-white text-gray-900 border border-gray-300 rounded-md text-center focus:ring-indigo-500 focus:border-indigo-500\"\n                    placeholder=\"3\"\n                    value={indirectAttainment[po.id] ?? ''}\n                    onChange={(e) => handleIndirectChange(po.id, e.target.value)}\n                  />\n                </td>\n              ))}\n            </tr>\n            <tr className=\"bg-gray-100 font-bold\">\n              <td className=\"border border-gray-300 p-2 text-gray-800\">Overall Attainment</td>\n              <td className=\"border border-gray-300 p-2 text-center text-gray-800\">100%</td>\n              {programOutcomes.map(po => (\n                <td key={po.id} className=\"border border-gray-300 p-2 text-center text-xl text-yellow-600\">\n                  {calculateOverall(po.id)}\n                </td>\n              ))}\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n};\n\nexport default POAttainmentDashboard;",
  "pages/StudentCOAttainmentReport.tsx": "import React, { useMemo } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useAppContext } from '../hooks/useAppContext';\n\nconst StudentCOAttainmentReport: React.FC = () => {\n    const { courseId } = useParams();\n    const { data } = useAppContext();\n\n    const course = useMemo(() => data.courses.find(c => c.id === courseId), [courseId, data.courses]);\n    const courseOutcomes = useMemo(() => data.courseOutcomes.filter(co => co.courseId === courseId).sort((a, b) => a.number.localeCompare(b.number)), [courseId, data.courseOutcomes]);\n\n    const studentAttainmentData = useMemo(() => {\n        if (!courseId || !courseOutcomes || courseOutcomes.length === 0) return [];\n\n        // Get all data related to the course first\n        // FIX: Assessments are linked to sections, not directly to courses. This logic finds all assessments for a course via its sections from enrollments.\n        const sectionIdsForCourse = new Set(data.enrollments.filter(e => e.courseId === courseId && e.sectionId).map(e => e.sectionId!));\n        const assessmentsForCourse = data.assessments.filter(a => sectionIdsForCourse.has(a.sectionId));\n        const enrolledStudentIds = new Set(data.enrollments.filter(e => e.courseId === courseId).map(e => e.studentId));\n        const studentsInCourse = data.students.filter(s => enrolledStudentIds.has(s.id));\n        \n        // Create a map for faster mark lookups: studentId -> assessmentId -> {scoreMap}\n        const studentMarksMap = new Map<string, Map<string, Map<string, number>>>();\n        data.marks\n            .filter(m => enrolledStudentIds.has(m.studentId))\n            .forEach(mark => {\n                if (!studentMarksMap.has(mark.studentId)) {\n                    studentMarksMap.set(mark.studentId, new Map());\n                }\n                const assessmentMap = studentMarksMap.get(mark.studentId)!;\n                const scoreMap = new Map<string, number>();\n                mark.scores.forEach(s => scoreMap.set(s.q, s.marks));\n                assessmentMap.set(mark.assessmentId, scoreMap);\n            });\n            \n        // Create a map for faster CO question lookups: coId -> { qName, maxMarks, assessmentId }[]\n        const coQuestionMap = new Map<string, { q: string; maxMarks: number; assessmentId: string }[]>();\n        courseOutcomes.forEach(co => coQuestionMap.set(co.id, []));\n\n        assessmentsForCourse.forEach(assessment => {\n            assessment.questions.forEach(q => {\n                q.coIds.forEach(coId => {\n                    if (coQuestionMap.has(coId)) {\n                        coQuestionMap.get(coId)!.push({ q: q.q, maxMarks: q.maxMarks, assessmentId: assessment.id });\n                    }\n                });\n            });\n        });\n\n        return studentsInCourse.map(student => {\n            const attainments: { [coId: string]: number } = {};\n\n            courseOutcomes.forEach(co => {\n                const questionsForCo = coQuestionMap.get(co.id) || [];\n                if (questionsForCo.length === 0) {\n                    attainments[co.id] = 0;\n                    return;\n                }\n\n                const totalMaxMarks = questionsForCo.reduce((sum, q) => sum + q.maxMarks, 0);\n                let totalObtainedMarks = 0;\n                \n                const studentAssessmentMarks = studentMarksMap.get(student.id);\n\n                if (studentAssessmentMarks) {\n                    totalObtainedMarks = questionsForCo.reduce((sum, q) => {\n                        const score = studentAssessmentMarks.get(q.assessmentId)?.get(q.q);\n                        return sum + (score || 0);\n                    }, 0);\n                }\n                \n                attainments[co.id] = totalMaxMarks > 0 ? (totalObtainedMarks / totalMaxMarks) * 100 : 0;\n            });\n\n            const coAttainmentValues = Object.values(attainments);\n            const overallAttainment = coAttainmentValues.length > 0 \n                ? coAttainmentValues.reduce((sum, val) => sum + val, 0) / coAttainmentValues.length \n                : 0;\n\n            return { student, attainments, overallAttainment };\n        }).sort((a,b) => a.student.id.localeCompare(b.student.id));\n\n    }, [courseId, data, courseOutcomes]);\n\n    if (!course) {\n        return <div className=\"text-center text-red-500\">Course not found.</div>;\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold text-gray-800\">Student CO Attainment Report</h1>\n            <p className=\"text-gray-500\">Course: {course.name} ({course.code})</p>\n\n            <div className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n                <div className=\"overflow-x-auto\">\n                    <table className=\"min-w-full\">\n                        <thead className=\"bg-gray-50\">\n                            <tr>\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Student ID</th>\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Student Name</th>\n                                {courseOutcomes.map(co => (\n                                    <th key={co.id} className=\"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\" title={co.description}>{co.number} Attainment %</th>\n                                ))}\n                                <th className=\"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\">Overall Attainment %</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-gray-200\">\n                            {studentAttainmentData.map(({ student, attainments, overallAttainment }) => (\n                                <tr key={student.id} className=\"hover:bg-gray-50\">\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{student.id}</td>\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">{student.name}</td>\n                                    {courseOutcomes.map(co => (\n                                        <td key={co.id} className=\"px-6 py-4 whitespace-nowrap text-sm text-center\">\n                                            <span className={`font-semibold ${attainments[co.id] >= course.target ? 'text-green-600' : 'text-red-600'}`}>\n                                                {attainments[co.id].toFixed(0)}%\n                                            </span>\n                                        </td>\n                                    ))}\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-center\">\n                                        <span className={`font-bold px-2 py-1 rounded-md ${overallAttainment >= course.target ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\n                                            {overallAttainment.toFixed(0)}%\n                                        </span>\n                                    </td>\n                                </tr>\n                            ))}\n                            {studentAttainmentData.length === 0 && (\n                                <tr>\n                                    <td colSpan={courseOutcomes.length + 3} className=\"text-center py-8 text-gray-500\">\n                                        No student data available to generate the report.\n                                    </td>\n                                </tr>\n                            )}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default StudentCOAttainmentReport;",
  "pages/SettingsScreen.tsx": "// FIX: Add React import to resolve \"Cannot find namespace 'React'\" error.\nimport React from 'react';\n\nconst SettingsScreen: React.FC = () => {\n  return (\n    <div className=\"space-y-6\">\n      <h1 className=\"text-3xl font-bold text-gray-800\">Settings</h1>\n      <div className=\"bg-white p-6 rounded-lg shadow-md\">\n        <h2 className=\"text-xl font-semibold text-gray-700 mb-4\">Manage Colleges</h2>\n        <p className=\"text-gray-600\">Functionality to add, edit, or remove colleges would be here. (Admin only)</p>\n        {/* Placeholder for college management UI */}\n      </div>\n       <div className=\"bg-white p-6 rounded-lg shadow-md\">\n        <h2 className=\"text-xl font-semibold text-gray-700 mb-4\">Manage Programs</h2>\n        <p className=\"text-gray-600\">Functionality to add, edit, or remove programs for each college would be here. (Admin only)</p>\n        {/* Placeholder for program management UI */}\n      </div>\n    </div>\n  );\n};\n\nexport default SettingsScreen;",
  "components/Icons.tsx": "import React from 'react';\n\ntype IconProps = React.SVGProps<SVGSVGElement>;\n\n// FIX: Corrected SVG syntax, specifically viewBox and ensuring all attributes are strings.\nexport const GraduationCap = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M22 10v6M2 10l10-5 10 5-10 5z\"/><path d=\"M6 12v5c3 3 12 3 15 0v-5\"/></svg>;\nexport const BookOpen = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z\"/><path d=\"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z\"/></svg>;\nexport const Target = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><circle cx=\"12\" cy=\"12\" r=\"10\"/><circle cx=\"12\" cy=\"12\" r=\"6\"/><circle cx=\"12\" cy=\"12\" r=\"2\"/></svg>;\nexport const Users = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/><circle cx=\"9\" cy=\"7\" r=\"4\"/><path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"/><path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/></svg>;\nexport const PieChart = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M21.21 15.89A10 10 0 1 1 8 2.83\"/><path d=\"M22 12A10 10 0 0 0 12 2v10z\"/></svg>;\nexport const Settings = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"/><circle cx=\"12\" cy=\"12\" r=\"3\"/></svg>;\nexport const LogOut = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\"/><polyline points=\"16 17 21 12 16 7\"/><line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\"/></svg>;\nexport const PlusCircle = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"16\"></line><line x1=\"8\" y1=\"12\" x2=\"16\" y2=\"12\"></line></svg>;\nexport const Trash2 = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><polyline points=\"3 6 5 6 21 6\"></polyline><path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path><line x1=\"10\" y1=\"11\" x2=\"10\" y2=\"17\"></line><line x1=\"14\" y1=\"11\" x2=\"14\" y2=\"17\"></line></svg>;\nexport const ArrowLeft = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\"></line><polyline points=\"12 19 5 12 12 5\"></polyline></svg>;\nexport const Edit = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path><path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path></svg>;\n// FIX: Corrected SVG syntax, specifically viewBox and ensuring all attributes are strings.\nexport const Upload = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path><polyline points=\"17 8 12 3 7 8\"></polyline><line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"></line></svg>;\nexport const Download = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path><polyline points=\"7 10 12 15 17 10\"></polyline><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line></svg>;\nexport const ChevronDown = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><polyline points=\"6 9 12 15 18 9\"></polyline></svg>;\nexport const ChevronUp = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><polyline points=\"18 15 12 9 6 15\"></polyline></svg>;\nexport const Grid = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"></rect><rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"></rect><rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"></rect><rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"></rect></svg>;",
  "pages/AttainmentReports.tsx": "// FIX: Add React import to resolve \"Cannot find namespace 'React'\" error.\nimport React from 'react';\n\nconst AttainmentReports: React.FC = () => {\n    return (\n        <div className=\"text-center p-8 bg-white rounded-lg shadow-md\">\n            <h1 className=\"text-2xl font-bold text-gray-700\">Feature Coming Soon</h1>\n            <p className=\"text-gray-500 mt-2\">The Attainment Reports section is currently under development.</p>\n        </div>\n    )\n};\n\nexport default AttainmentReports;",
  "components/AddCourseModal.tsx": "import React, { useState } from 'react';\nimport { Course } from '../types';\nimport Modal from './Modal';\n\ninterface AddCourseModalProps {\n  onClose: () => void;\n  onAdd: (course: Course) => void;\n  programId: string;\n}\n\nconst AddCourseModal: React.FC<AddCourseModalProps> = ({ onClose, onAdd, programId }) => {\n    const [code, setCode] = useState('');\n    const [name, setName] = useState('');\n    const [target, setTarget] = useState(50);\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        const newCourse: Course = {\n            id: `c_manual_${Date.now()}`,\n            programId,\n            code,\n            name,\n            target,\n            internalWeightage: 25,\n            externalWeightage: 75,\n            attainmentLevels: { level3: 80, level2: 70, level1: 50 },\n            status: 'Future', // Default status for new courses\n        };\n        onAdd(newCourse);\n    }\n\n    return (\n        <Modal title=\"Add New Course\" onClose={onClose}>\n            <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n                 <div>\n                    <label className=\"block text-sm font-medium text-gray-700\">Course Code</label>\n                    <input type=\"text\" value={code} onChange={e => setCode(e.target.value)} className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\" required/>\n                </div>\n                 <div>\n                    <label className=\"block text-sm font-medium text-gray-700\">Course Name</label>\n                    <input type=\"text\" value={name} onChange={e => setName(e.target.value)} className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\" required/>\n                </div>\n                <div>\n                    <label className=\"block text-sm font-medium text-gray-700\">Target Attainment (%)</label>\n                    <input type=\"number\" value={target} onChange={e => setTarget(Number(e.target.value))} className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\" required/>\n                </div>\n                <div className=\"flex justify-end pt-4\">\n                    <button type=\"button\" onClick={onClose} className=\"mr-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg\">Cancel</button>\n                    <button type=\"submit\" className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg\">Add Course</button>\n                </div>\n            </form>\n        </Modal>\n    )\n}\n\nexport default AddCourseModal;",
  "components/CourseOverviewTab.tsx": "import React, { useState, useEffect, useMemo } from 'react';\nimport { Course } from '../types';\nimport { useAppContext } from '../hooks/useAppContext';\nimport SaveBar from './SaveBar';\n\ninterface CourseOverviewTabProps {\n  course: Course;\n}\n\nconst CourseOverviewTab: React.FC<CourseOverviewTabProps> = ({ course }) => {\n  const { setData, currentUser } = useAppContext();\n  const isCoordinator = currentUser?.role === 'Program Co-ordinator';\n\n  const [draftCourse, setDraftCourse] = useState<Course>(course);\n  const [initialCourse, setInitialCourse] = useState<Course>(course);\n\n  useEffect(() => {\n    setDraftCourse(course);\n    setInitialCourse(course);\n  }, [course]);\n  \n  const isDirty = useMemo(() => JSON.stringify(initialCourse) !== JSON.stringify(draftCourse), [initialCourse, draftCourse]);\n\n  const updateDraftCourseField = (field: keyof Course, value: any) => {\n    setDraftCourse(prev => ({ ...prev, [field]: value }));\n  };\n\n  const updateDraftAttainmentLevel = (level: 'level1' | 'level2' | 'level3', value: number) => {\n     setDraftCourse(prev => ({ ...prev, attainmentLevels: { ...prev.attainmentLevels, [level]: value } }));\n  };\n\n  const handleSave = () => {\n    setData(prev => ({\n      ...prev,\n      courses: prev.courses.map(c => c.id === course.id ? draftCourse : c)\n    }));\n    setInitialCourse(draftCourse); // Update the baseline for isDirty check\n    alert(\"Changes saved successfully!\");\n  };\n\n  const handleCancel = () => {\n    setDraftCourse(initialCourse);\n  };\n\n\n  return (\n    <div className=\"space-y-6 pb-20\">\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">CO Target (%)</label>\n          <input \n            type=\"number\" \n            value={draftCourse.target} \n            onChange={e => updateDraftCourseField('target', Number(e.target.value))} \n            className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n            disabled={!isCoordinator}\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">Internal Weightage (%)</label>\n          <input \n            type=\"number\" \n            value={draftCourse.internalWeightage} \n            onChange={e => updateDraftCourseField('internalWeightage', Number(e.target.value))} \n            className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n            disabled={!isCoordinator}\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">External Weightage (%)</label>\n          <input \n            type=\"number\" \n            value={draftCourse.externalWeightage} \n            onChange={e => updateDraftCourseField('externalWeightage', Number(e.target.value))} \n            className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n            disabled={!isCoordinator}\n          />\n        </div>\n      </div>\n      \n      <div>\n        <h3 className=\"text-lg font-semibold text-gray-700 mb-2\">Attainment Level Thresholds</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <div>\n              <label className=\"block text-sm font-medium text-gray-700\">Level 3 (&ge; X % of students)</label>\n              <input \n                type=\"number\" \n                value={draftCourse.attainmentLevels.level3} \n                onChange={e => updateDraftAttainmentLevel('level3', Number(e.target.value))} \n                className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n                disabled={!isCoordinator}\n              />\n          </div>\n          <div>\n              <label className=\"block text-sm font-medium text-gray-700\">Level 2 (&ge; Y % of students)</label>\n              <input \n                type=\"number\" \n                value={draftCourse.attainmentLevels.level2} \n                onChange={e => updateDraftAttainmentLevel('level2', Number(e.target.value))} \n                className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n                disabled={!isCoordinator}\n              />\n          </div>\n           <div>\n              <label className=\"block text-sm font-medium text-gray-700\">Level 1 (&ge; Z % of students)</label>\n              <input \n                type=\"number\" \n                value={draftCourse.attainmentLevels.level1} \n                onChange={e => updateDraftAttainmentLevel('level1', Number(e.target.value))} \n                className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n                disabled={!isCoordinator}\n              />\n          </div>\n        </div>\n      </div>\n\n      <SaveBar isDirty={isDirty} onSave={handleSave} onCancel={handleCancel} />\n    </div>\n  );\n};\n\nexport default CourseOverviewTab;",
  "pages/StudentsList.tsx": "import React, { useState, useMemo } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { Student, StudentStatus } from '../types';\nimport ExcelUploader from '../components/ExcelUploader';\nimport StudentDetailsModal from '../components/StudentDetailsModal';\nimport ConfirmationModal from '../components/ConfirmationModal';\n\nconst StudentsList: React.FC = () => {\n  const { selectedProgram, selectedBatch, data, setData, currentUser, selectedCollegeId } = useAppContext();\n  \n  const [newStudentId, setNewStudentId] = useState('');\n  const [newStudentName, setNewStudentName] = useState('');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedStudent, setSelectedStudent] = useState<Student | null>(null);\n  const [confirmation, setConfirmation] = useState<{\n        isOpen: boolean;\n        title: string;\n        message: string;\n        onConfirm: () => void;\n    } | null>(null);\n\n  const isAdmin = currentUser?.role === 'Admin';\n  const isProgramCoordinator = currentUser?.role === 'Program Co-ordinator';\n  const canManage = isProgramCoordinator || isAdmin;\n\n  const { filteredStudents, pageTitle, subTitle } = useMemo(() => {\n    let students: Student[];\n        \n    if (isAdmin) {\n        students = data.students;\n        if (selectedProgram) {\n            students = students.filter(s => s.programId === selectedProgram.id);\n            if (selectedBatch) {\n                const batch = data.batches.find(b => b.programId === selectedProgram.id && b.name === selectedBatch);\n                if (batch) {\n                    const sectionsForBatch = data.sections.filter(s => s.batchId === batch.id);\n                    const sectionIdsForBatch = new Set(sectionsForBatch.map(s => s.id));\n                    students = students.filter(s => s.sectionId && sectionIdsForBatch.has(s.sectionId));\n                } else {\n                    students = []; // No batch found, show no students\n                }\n            }\n        } else if (selectedCollegeId) {\n            const programIdsInCollege = new Set(data.programs.filter(p => p.collegeId === selectedCollegeId).map(p => p.id));\n            students = students.filter(s => programIdsInCollege.has(s.programId));\n        }\n    } else { // Teacher or PC\n        students = data.students.filter(s => s.programId === selectedProgram?.id);\n    }\n\n    if (searchTerm) {\n      const lowercasedFilter = searchTerm.toLowerCase();\n      students = students.filter(student =>\n        student.name.toLowerCase().includes(lowercasedFilter) ||\n        student.id.toLowerCase().includes(lowercasedFilter)\n      );\n    }\n    \n    const title = isAdmin\n      ? selectedProgram\n          ? `Students in ${selectedProgram.name}`\n          : selectedCollegeId\n              ? `Students in ${data.colleges.find(c => c.id === selectedCollegeId)?.name}`\n              : 'All Students'\n      : 'Student Management';\n\n    const subtitle = isAdmin\n      ? selectedBatch && selectedProgram\n          ? `Displaying batch ${selectedBatch}`\n          : 'Select a college and program to see students.'\n      : `Manage students for the ${selectedProgram?.name} program.`;\n      \n    return {\n      filteredStudents: students.sort((a, b) => a.name.localeCompare(b.name)),\n      pageTitle: title,\n      subTitle: subtitle\n    }\n  }, [data, selectedProgram, selectedBatch, currentUser, selectedCollegeId, searchTerm, isAdmin]);\n  \n  const canAddStudents = canManage && (isProgramCoordinator || (isAdmin && selectedProgram));\n\n  const handleStatusChange = (studentId: string, newStatus: StudentStatus) => {\n    setConfirmation({\n        isOpen: true,\n        title: \"Confirm Status Change\",\n        message: \"Are you sure you want to change this student's status?\",\n        onConfirm: () => {\n            setData(prev => ({\n                ...prev,\n                students: prev.students.map(s => s.id === studentId ? { ...s, status: newStatus } : s)\n            }));\n            setConfirmation(null);\n        },\n    });\n  };\n\n  const handleAddStudent = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newStudentId.trim() || !newStudentName.trim() || !selectedProgram) {\n      alert(\"Please provide both a Student ID and Name.\");\n      return;\n    }\n    \n    if (data.students.some(s => s.id.toLowerCase() === newStudentId.trim().toLowerCase())) {\n        alert(\"A student with this ID already exists.\");\n        return;\n    }\n\n    const newStudent: Student = {\n      id: newStudentId.trim(),\n      name: newStudentName.trim(),\n      programId: selectedProgram.id,\n      status: 'Active'\n    };\n\n    setData(prev => ({\n      ...prev,\n      students: [...prev.students, newStudent]\n    }));\n\n    setNewStudentId('');\n    setNewStudentName('');\n  };\n\n  const handleExcelUpload = (uploadedData: { id: string; name: string }[]) => {\n    if (!selectedProgram) {\n        alert(\"Please select a program before bulk uploading students.\");\n        return;\n    }\n    const existingStudentIds = new Set(data.students.map(s => s.id.toLowerCase()));\n    const newStudents: Student[] = uploadedData\n      .filter(row => row.id && row.name && !existingStudentIds.has(String(row.id).toLowerCase()))\n      .map(row => ({\n        id: String(row.id),\n        name: String(row.name),\n        programId: selectedProgram.id,\n        status: 'Active'\n      }));\n    setData(prev => ({ ...prev, students: [...prev.students, ...newStudents] }));\n    alert(`${newStudents.length} new students were added.`);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <h1 className=\"text-3xl font-bold text-gray-800\">{pageTitle}</h1>\n      <p className=\"text-gray-500\">{subTitle}</p>\n      \n      {canAddStudents && (\n        <div className=\"bg-white p-6 rounded-lg shadow-md\">\n          <div className=\"flex justify-between items-center mb-4\">\n              <h2 className=\"text-xl font-semibold text-gray-700\">Add Students</h2>\n               <ExcelUploader<{ id: string; name: string }>\n                onFileUpload={handleExcelUpload}\n                label=\"Upload Excel\"\n                format=\"columns: id, name\"\n              />\n          </div>\n          <form onSubmit={handleAddStudent} className=\"flex flex-wrap gap-4 items-end\">\n              <div className=\"flex-grow\">\n                  <label className=\"block text-sm font-medium text-gray-700\">Student ID</label>\n                  <input type=\"text\" value={newStudentId} onChange={e => setNewStudentId(e.target.value)} className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900\" required />\n              </div>\n               <div className=\"flex-grow-[2]\">\n                  <label className=\"block text-sm font-medium text-gray-700\">Student Name</label>\n                  <input type=\"text\" value={newStudentName} onChange={e => setNewStudentName(e.target.value)} className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900\" required />\n              </div>\n              <button type=\"submit\" className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg\">Add Student</button>\n          </form>\n        </div>\n      )}\n\n      <div className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n        <div className=\"p-4 border-b\">\n          <input\n            type=\"text\"\n            placeholder=\"Search students by name or ID...\"\n            value={searchTerm}\n            onChange={e => setSearchTerm(e.target.value)}\n            className=\"w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:ring-indigo-500 focus:border-indigo-500\"\n          />\n        </div>\n        <table className=\"min-w-full\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Student ID</th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Student Name</th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n              <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n            </tr>\n          </thead>\n          <tbody className=\"divide-y divide-gray-200\">\n            {filteredStudents.map((student) => (\n              <tr key={student.id} className=\"hover:bg-gray-50\">\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{student.id}</td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">{student.name}</td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\n                    {canManage ? (\n                      <select\n                        value={student.status}\n                        onChange={(e) => handleStatusChange(student.id, e.target.value as StudentStatus)}\n                        className={`p-1 border rounded-md bg-white text-gray-900 focus:ring-indigo-500 focus:border-indigo-500 ${student.status === 'Active' ? 'border-green-300' : 'border-red-300'}`}\n                      >\n                        <option value=\"Active\">Active</option>\n                        <option value=\"Inactive\">Inactive</option>\n                      </select>\n                    ) : (\n                       <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${student.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\n                          {student.status}\n                      </span>\n                    )}\n                </td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                  <button onClick={() => setSelectedStudent(student)} className=\"text-indigo-600 hover:text-indigo-800\">\n                    View Details\n                  </button>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n\n      {selectedStudent && (\n        <StudentDetailsModal student={selectedStudent} onClose={() => setSelectedStudent(null)} />\n      )}\n      \n      {confirmation && (\n        <ConfirmationModal \n            isOpen={confirmation.isOpen}\n            title={confirmation.title}\n            message={confirmation.message}\n            onConfirm={confirmation.onConfirm}\n            onClose={() => setConfirmation(null)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default StudentsList;",
  "components/CreateAssessmentModal.tsx": "import React, { useState } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport Modal from './Modal';\nimport { Assessment } from '../types';\n\ninterface CreateAssessmentModalProps {\n  sectionId: string;\n  onClose: () => void;\n}\n\nconst CreateAssessmentModal: React.FC<CreateAssessmentModalProps> = ({ sectionId, onClose }) => {\n  const { setData } = useAppContext();\n  const [name, setName] = useState('');\n  const [type, setType] = useState<'Internal' | 'External'>('Internal');\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!name.trim()) {\n      alert(\"Please provide an assessment name.\");\n      return;\n    }\n    const newAssessment: Assessment = {\n      id: `as_${Date.now()}`,\n      sectionId,\n      name: name.trim(),\n      type,\n      questions: []\n    };\n    \n    setData(prev => ({\n      ...prev,\n      assessments: [...prev.assessments, newAssessment]\n    }));\n    \n    onClose();\n  };\n\n  return (\n    <Modal title=\"Create New Assessment\" onClose={onClose}>\n      <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">Assessment Name</label>\n          <input\n            type=\"text\"\n            value={name}\n            onChange={e => setName(e.target.value)}\n            className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            required\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">Assessment Type</label>\n          <select\n            value={type}\n            onChange={e => setType(e.target.value as 'Internal' | 'External')}\n            className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n          >\n            <option value=\"Internal\">Internal</option>\n            <option value=\"External\">External</option>\n          </select>\n        </div>\n        <div className=\"flex justify-end pt-4 gap-3\">\n            <button type=\"button\" onClick={onClose} className=\"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg\">Cancel</button>\n            <button type=\"submit\" className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg\">Create</button>\n        </div>\n      </form>\n    </Modal>\n  );\n};\n\nexport default CreateAssessmentModal;",
  "components/AddProgramOutcomeModal.tsx": "import React, { useState } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { ProgramOutcome } from '../types';\nimport Modal from './Modal';\n\ninterface AddProgramOutcomeModalProps {\n  onClose: () => void;\n}\n\nconst AddProgramOutcomeModal: React.FC<AddProgramOutcomeModalProps> = ({ onClose }) => {\n  const { setData, selectedProgram } = useAppContext();\n  const [number, setNumber] = useState('');\n  const [description, setDescription] = useState('');\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!number.trim() || !description.trim() || !selectedProgram) {\n      alert(\"Please fill out all fields.\");\n      return;\n    }\n    const newPO: ProgramOutcome = {\n      id: `po_manual_${Date.now()}`,\n      programId: selectedProgram.id,\n      number: number.trim(),\n      description: description.trim()\n    };\n    setData(prev => ({\n      ...prev,\n      programOutcomes: [...prev.programOutcomes, newPO]\n    }));\n    onClose();\n  };\n\n  return (\n    <Modal title=\"Add New Program Outcome\" onClose={onClose}>\n      <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">PO Number (e.g., PO1)</label>\n          <input\n            type=\"text\"\n            value={number}\n            onChange={e => setNumber(e.target.value)}\n            className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            required\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">Description</label>\n          <textarea\n            value={description}\n            onChange={e => setDescription(e.target.value)}\n            rows={3}\n            className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            required\n          />\n        </div>\n        <div className=\"flex justify-end pt-4 gap-3\">\n          <button type=\"button\" onClick={onClose} className=\"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg\">Cancel</button>\n          <button type=\"submit\" className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg\">Add PO</button>\n        </div>\n      </form>\n    </Modal>\n  );\n};\n\nexport default AddProgramOutcomeModal;",
  "components/ConfirmationModal.tsx": "import React from 'react';\n\ninterface ConfirmationModalProps {\n  isOpen: boolean;\n  title: string;\n  message: string;\n  onConfirm: () => void;\n  onClose: () => void;\n}\n\nconst ConfirmationModal: React.FC<ConfirmationModalProps> = ({ isOpen, title, message, onConfirm, onClose }) => {\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={onClose}>\n      <div className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4\" onClick={(e) => e.stopPropagation()}>\n        <h2 className=\"text-xl font-bold text-gray-800\">{title}</h2>\n        <p className=\"mt-4 text-gray-600\">{message}</p>\n        <div className=\"mt-6 flex justify-end gap-4\">\n          <button \n            type=\"button\" \n            onClick={onClose} \n            className=\"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold\"\n          >\n            Cancel\n          </button>\n          <button \n            type=\"button\" \n            onClick={onConfirm} \n            className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-semibold\"\n          >\n            Confirm\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ConfirmationModal;",
  "components/StudentDetailsModal.tsx": "import React, { useMemo } from 'react';\nimport { Student } from '../types';\nimport { useAppContext } from '../hooks/useAppContext';\nimport Modal from './Modal';\n\ninterface StudentDetailsModalProps {\n  student: Student;\n  onClose: () => void;\n}\n\nconst StudentDetailsModal: React.FC<StudentDetailsModalProps> = ({ student, onClose }) => {\n  const { data } = useAppContext();\n\n  const studentCourseData = useMemo(() => {\n    const enrolledCourseIds = new Set(data.enrollments.filter(e => e.studentId === student.id).map(e => e.courseId));\n    const enrolledCourses = data.courses.filter(c => enrolledCourseIds.has(c.id));\n\n    return enrolledCourses.map(course => {\n      const courseOutcomes = data.courseOutcomes.filter(co => co.courseId === course.id);\n\n      if (course.status === 'Future') {\n        return { course, coAttainments: null, overallAttainment: null };\n      }\n\n      const coAttainments = courseOutcomes.map(co => {\n        let obtainedMarks = 0;\n        let possibleMarks = 0;\n\n        // FIX: Assessments are linked via sections, not directly to courses. This logic finds all assessments for a course via its sections from enrollments.\n        const sectionIdsForCourse = new Set(data.enrollments.filter(e => e.courseId === course.id && e.sectionId).map(e => e.sectionId!));\n        const assessmentsForCourse = data.assessments.filter(a => sectionIdsForCourse.has(a.sectionId));\n\n        assessmentsForCourse.forEach(assessment => {\n          const questionsForCo = assessment.questions.filter(q => q.coIds.includes(co.id));\n\n          questionsForCo.forEach(question => {\n            const studentMark = data.marks.find(m => m.assessmentId === assessment.id && m.studentId === student.id);\n            if (studentMark) {\n              const score = studentMark.scores.find(s => s.q === question.q);\n              if (score !== undefined) {\n                obtainedMarks += score.marks;\n                possibleMarks += question.maxMarks;\n              }\n            }\n          });\n        });\n\n        const percentage = possibleMarks > 0 ? (obtainedMarks / possibleMarks) * 100 : 0;\n        \n        return {\n          coNumber: co.number,\n          percentage: percentage,\n        };\n      });\n\n      const overallAttainment = coAttainments.length > 0\n        ? coAttainments.reduce((sum, att) => sum + att.percentage, 0) / coAttainments.length\n        : 0;\n\n\n      return { course, coAttainments, overallAttainment };\n    });\n  }, [student, data]);\n\n  return (\n    <Modal title={`Student Details`} onClose={onClose}>\n      <div className=\"p-6\">\n        <div className=\"mb-6 pb-4 border-b\">\n          <h3 className=\"text-xl font-bold text-gray-800\">{student.name}</h3>\n          <p className=\"text-sm text-gray-500\">Student ID: {student.id}</p>\n        </div>\n        \n        <div className=\"space-y-4 max-h-[60vh] overflow-y-auto pr-2\">\n          <h4 className=\"font-semibold text-gray-700\">Enrolled Courses</h4>\n          {studentCourseData.length > 0 ? (\n            studentCourseData.map(({ course, coAttainments, overallAttainment }) => (\n              <div key={course.id} className=\"bg-gray-50 p-4 rounded-lg border\">\n                <p className=\"font-bold text-gray-800\">{course.name} ({course.code})</p>\n                \n                {coAttainments && overallAttainment !== null ? (\n                  <>\n                    <div className=\"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 text-sm\">\n                        {coAttainments.map(attainment => (\n                        <div key={attainment.coNumber}>\n                            <span className=\"font-semibold\">{attainment.coNumber}:</span>\n                            <span className=\"ml-2 text-gray-600\">{attainment.percentage.toFixed(2)}%</span>\n                        </div>\n                        ))}\n                        {coAttainments.length === 0 && <p className=\"text-gray-500 col-span-full\">No COs defined for this course.</p>}\n                    </div>\n                    <div className=\"mt-3 pt-3 border-t border-gray-200\">\n                        <span className=\"font-semibold text-gray-800\">Overall Course Attainment:</span>\n                         <span className={`ml-2 font-bold px-2 py-1 rounded-md text-sm ${overallAttainment >= course.target ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\n                            {overallAttainment.toFixed(2)}%\n                        </span>\n                    </div>\n                  </>\n                ) : (\n                  <p className=\"mt-2 text-sm text-gray-500 italic\">(Future Course - No attainment data)</p>\n                )}\n              </div>\n            ))\n          ) : (\n            <p className=\"text-gray-500\">This student is not enrolled in any courses.</p>\n          )}\n        </div>\n        \n        <div className=\"mt-6 flex justify-end\">\n            <button onClick={onClose} className=\"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg\">Close</button>\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport default StudentDetailsModal;",
  "pages/UserManagement.tsx": "import React, { useMemo, useState, useEffect } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { User, Program } from '../types';\nimport SaveBar from '../components/SaveBar';\n\nconst UserManagement: React.FC = () => {\n    const { data, setData, currentUser } = useAppContext();\n\n    const { programCoordinators, teachers, programs } = useMemo(() => ({\n        programCoordinators: data.users.filter(u => u.role === 'Program Co-ordinator'),\n        teachers: data.users.filter(u => u.role === 'Teacher'),\n        programs: data.programs,\n    }), [data]);\n\n    // --- Draft State Management ---\n    const [draftPcAssignments, setDraftPcAssignments] = useState<{ [programId: string]: string }>({});\n    const [initialPcAssignments, setInitialPcAssignments] = useState<{ [programId: string]: string }>({});\n    const [draftTeacherAssignments, setDraftTeacherAssignments] = useState<{ [teacherId: string]: string[] }>({});\n    const [initialTeacherAssignments, setInitialTeacherAssignments] = useState<{ [teacherId: string]: string[] }>({});\n\n    useEffect(() => {\n        // Init PC assignments\n        const pcAssignments: { [programId: string]: string } = {};\n        programs.forEach(p => {\n            const assignedPC = programCoordinators.find(pc => pc.programId === p.id);\n            pcAssignments[p.id] = assignedPC ? assignedPC.id : '';\n        });\n        setDraftPcAssignments(pcAssignments);\n        setInitialPcAssignments(pcAssignments);\n\n        // Init Teacher assignments\n        const teacherAssignments: { [teacherId: string]: string[] } = {};\n        teachers.forEach(t => {\n            teacherAssignments[t.id] = t.programCoordinatorIds || [];\n        });\n        setDraftTeacherAssignments(teacherAssignments);\n        setInitialTeacherAssignments(teacherAssignments);\n    }, [programs, programCoordinators, teachers]);\n\n    const isDirty = useMemo(() => \n        JSON.stringify(draftPcAssignments) !== JSON.stringify(initialPcAssignments) ||\n        JSON.stringify(draftTeacherAssignments) !== JSON.stringify(initialTeacherAssignments),\n    [draftPcAssignments, initialPcAssignments, draftTeacherAssignments, initialTeacherAssignments]);\n\n\n    const handleProgramAssignmentChange = (programId: string, pcId: string) => {\n        setDraftPcAssignments(prev => ({...prev, [programId]: pcId}));\n    };\n    \n    const handleTeacherAssignmentChange = (teacherId: string, pcId: string) => {\n        setDraftTeacherAssignments(prev => ({...prev, [teacherId]: pcId ? [pcId] : []}));\n    };\n\n    const handleSave = () => {\n        setData(prev => {\n            const updatedUsers = prev.users.map(user => {\n                let updatedUser = { ...user };\n                \n                // Apply PC assignment changes\n                if (updatedUser.role === 'Program Co-ordinator') {\n                    const assignedProgramId = Object.keys(draftPcAssignments).find(\n                        progId => draftPcAssignments[progId] === updatedUser.id\n                    );\n                    if (assignedProgramId) {\n                        updatedUser.programId = assignedProgramId;\n                    } else if (updatedUser.programId && !Object.values(draftPcAssignments).includes(updatedUser.id)) {\n                        delete updatedUser.programId;\n                    }\n                }\n                \n                // Apply Teacher assignment changes\n                if (updatedUser.role === 'Teacher') {\n                    // Check if there's a draft entry for this teacher before updating\n                    if (draftTeacherAssignments[updatedUser.id] !== undefined) {\n                        updatedUser.programCoordinatorIds = draftTeacherAssignments[updatedUser.id];\n                    }\n                }\n                \n                return updatedUser;\n            });\n            return { ...prev, users: updatedUsers };\n        });\n        \n        setInitialPcAssignments(draftPcAssignments);\n        setInitialTeacherAssignments(draftTeacherAssignments);\n        alert(\"User assignments saved!\");\n    };\n    \n    const handleCancel = () => {\n        setDraftPcAssignments(initialPcAssignments);\n        setDraftTeacherAssignments(initialTeacherAssignments);\n    };\n\n\n    if (currentUser?.role !== 'Admin') {\n        return (\n            <div className=\"text-center p-8 bg-white rounded-lg shadow-md\">\n                <h1 className=\"text-2xl font-bold text-red-600\">Access Denied</h1>\n                <p className=\"text-gray-500 mt-2\">You do not have permission to view this page.</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-8 pb-20\">\n            <h1 className=\"text-3xl font-bold text-gray-800\">User Management</h1>\n\n            <div className=\"bg-white p-6 rounded-lg shadow-md\">\n                <h2 className=\"text-2xl font-semibold text-gray-700 mb-4\">Program Assignments</h2>\n                <div className=\"overflow-x-auto\">\n                    <table className=\"min-w-full divide-y divide-gray-200\">\n                        <thead className=\"bg-gray-50\">\n                            <tr>\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Program</th>\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Assigned Program Co-ordinator</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\n                            {programs.map(program => (\n                                <tr key={program.id}>\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{program.name}</td>\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                        <select\n                                            value={draftPcAssignments[program.id] || ''}\n                                            onChange={(e) => handleProgramAssignmentChange(program.id, e.target.value)}\n                                            className=\"p-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:ring-indigo-500 focus:border-indigo-500\"\n                                        >\n                                            <option value=\"\">-- Unassigned --</option>\n                                            {programCoordinators.map(pc => (\n                                                <option key={pc.id} value={pc.id}>{pc.name}</option>\n                                            ))}\n                                        </select>\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <div className=\"bg-white p-6 rounded-lg shadow-md\">\n                <h2 className=\"text-2xl font-semibold text-gray-700 mb-4\">Teacher Assignments</h2>\n                <div className=\"overflow-x-auto\">\n                    <table className=\"min-w-full divide-y divide-gray-200\">\n                        <thead className=\"bg-gray-50\">\n                            <tr>\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Teacher Name</th>\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Reports to (Co-ordinator)</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\n                            {teachers.map(teacher => (\n                                <tr key={teacher.id}>\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{teacher.name}</td>\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                        <select\n                                            value={draftTeacherAssignments[teacher.id]?.[0] || ''}\n                                            onChange={(e) => handleTeacherAssignmentChange(teacher.id, e.target.value)}\n                                            className=\"p-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:ring-indigo-500 focus:border-indigo-500\"\n                                        >\n                                            <option value=\"\">-- Unassigned --</option>\n                                            {programCoordinators.map(pc => (\n                                                <option key={pc.id} value={pc.id}>{pc.name}</option>\n                                            ))}\n                                        </select>\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n            <SaveBar isDirty={isDirty} onSave={handleSave} onCancel={handleCancel} />\n        </div>\n    );\n};\n\nexport default UserManagement;",
  "pages/TeacherManagement.tsx": "import React, { useMemo, useState } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { Link } from 'react-router-dom';\nimport ConfirmationModal from '../components/ConfirmationModal';\n\nconst TeacherManagement: React.FC = () => {\n    const { data, setData, currentUser } = useAppContext();\n    const [searchTerm, setSearchTerm] = useState('');\n    const [confirmation, setConfirmation] = useState<{\n        isOpen: boolean;\n        title: string;\n        message: string;\n        onConfirm: () => void;\n    } | null>(null);\n\n    const managedTeachers = useMemo(() => {\n        if (currentUser?.role !== 'Program Co-ordinator') return [];\n        \n        let teachers = data.users.filter(u => u.role === 'Teacher' && u.programCoordinatorIds?.includes(currentUser.id));\n\n        if (searchTerm) {\n            const lowercasedFilter = searchTerm.toLowerCase();\n            teachers = teachers.filter(teacher =>\n                teacher.name.toLowerCase().includes(lowercasedFilter) ||\n                teacher.employeeId.toLowerCase().includes(lowercasedFilter)\n            );\n        }\n        \n        return teachers;\n    }, [data.users, currentUser, searchTerm]);\n\n    const handleStatusChange = (teacherId: string, status: 'Active' | 'Inactive') => {\n        setConfirmation({\n            isOpen: true,\n            title: \"Confirm Status Change\",\n            message: \"Are you sure you want to change this teacher's status?\",\n            onConfirm: () => {\n                setData(prev => ({\n                    ...prev,\n                    users: prev.users.map(u => u.id === teacherId ? { ...u, status } : u)\n                }));\n                setConfirmation(null);\n            }\n        });\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold text-gray-800\">Teacher Management</h1>\n            <p className=\"text-gray-500\">Manage teachers and course assignments for your program.</p>\n            \n            <div className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n                <div className=\"p-4 border-b\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Search by Teacher Name or Employee ID...\"\n                    value={searchTerm}\n                    onChange={e => setSearchTerm(e.target.value)}\n                    className=\"w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:ring-indigo-500 focus:border-indigo-500\"\n                  />\n                </div>\n                <table className=\"min-w-full\">\n                    <thead className=\"bg-gray-50\">\n                        <tr>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Teacher Name</th>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Employee ID</th>\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                            <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                        </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-gray-200\">\n                        {managedTeachers.length > 0 ? (\n                            managedTeachers.map(teacher => (\n                                <tr key={teacher.id} className=\"hover:bg-gray-50\">\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                                        {teacher.name}\n                                    </td>\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                        {teacher.employeeId}\n                                    </td>\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                                        <select\n                                            value={teacher.status}\n                                            onChange={(e) => handleStatusChange(teacher.id, e.target.value as 'Active' | 'Inactive')}\n                                            className={`p-1 border rounded-md bg-white text-gray-900 focus:ring-indigo-500 focus:border-indigo-500 ${teacher.status === 'Active' ? 'border-green-300' : 'border-red-300'}`}\n                                        >\n                                            <option value=\"Active\">Active</option>\n                                            <option value=\"Inactive\">Inactive</option>\n                                        </select>\n                                    </td>\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                                        <Link to={`/teachers/${teacher.id}`} className=\"text-indigo-600 hover:text-indigo-800 font-semibold\">\n                                            View Dashboard\n                                        </Link>\n                                    </td>\n                                </tr>\n                            ))\n                        ) : (\n                             <tr>\n                                <td colSpan={4} className=\"text-center py-8 text-gray-500\">\n                                    No teachers found.\n                                </td>\n                            </tr>\n                        )}\n                    </tbody>\n                </table>\n            </div>\n\n            {confirmation && (\n                <ConfirmationModal \n                    isOpen={confirmation.isOpen}\n                    title={confirmation.title}\n                    message={confirmation.message}\n                    onConfirm={confirmation.onConfirm}\n                    onClose={() => setConfirmation(null)}\n                />\n            )}\n        </div>\n    );\n};\n\nexport default TeacherManagement;",
  "components/AssignCoursesModal.tsx": "import React, { useState, useMemo } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { User, Course } from '../types';\nimport Modal from './Modal';\n\ninterface AssignCoursesModalProps {\n    teacher: User;\n    onClose: () => void;\n}\n\nconst AssignCoursesModal: React.FC<AssignCoursesModalProps> = ({ teacher, onClose }) => {\n    const { data, setData, currentUser } = useAppContext();\n    const [selectedCourseIds, setSelectedCourseIds] = useState<string[]>([]);\n\n    const unassignedCourses = useMemo(() => {\n        if (!currentUser?.programId) return [];\n        return data.courses.filter(c => c.programId === currentUser.programId && !c.teacherId);\n    }, [data.courses, currentUser]);\n\n    const handleToggleSelection = (courseId: string) => {\n        setSelectedCourseIds(prev =>\n            prev.includes(courseId) ? prev.filter(id => id !== courseId) : [...prev, courseId]\n        );\n    };\n\n    const handleAssignCourses = () => {\n        setData(prev => ({\n            ...prev,\n            courses: prev.courses.map(c =>\n                selectedCourseIds.includes(c.id) ? { ...c, teacherId: teacher.id } : c\n            )\n        }));\n        onClose();\n    };\n\n    return (\n        <Modal title={`Assign Courses to ${teacher.name}`} onClose={onClose}>\n            <div className=\"p-6\">\n                <div className=\"space-y-2 max-h-80 overflow-y-auto pr-2\">\n                    {unassignedCourses.length > 0 ? (\n                        unassignedCourses.map(course => (\n                            <label key={course.id} className=\"flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer\">\n                                <input\n                                    type=\"checkbox\"\n                                    checked={selectedCourseIds.includes(course.id)}\n                                    onChange={() => handleToggleSelection(course.id)}\n                                    className=\"h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\n                                />\n                                <span className=\"ml-3 text-gray-800 font-medium\">{course.code} - {course.name}</span>\n                            </label>\n                        ))\n                    ) : (\n                        <p className=\"text-center text-gray-500 py-4\">No unassigned courses available in this program.</p>\n                    )}\n                </div>\n                <div className=\"mt-6 flex justify-end gap-4\">\n                    <button type=\"button\" onClick={onClose} className=\"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold\">Cancel</button>\n                    <button\n                        type=\"button\"\n                        onClick={handleAssignCourses}\n                        disabled={selectedCourseIds.length === 0}\n                        className=\"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 font-semibold disabled:bg-indigo-300 disabled:cursor-not-allowed\"\n                    >\n                        Assign ({selectedCourseIds.length})\n                    </button>\n                </div>\n            </div>\n        </Modal>\n    );\n};\n\nexport default AssignCoursesModal;",
  "pages/TeacherDetails.tsx": "import React, { useMemo } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { useAppContext } from '../hooks/useAppContext';\n\nconst TeacherDetails: React.FC = () => {\n    const { teacherId } = useParams<{ teacherId: string }>();\n    const { data } = useAppContext();\n\n    const teacher = useMemo(() => data.users.find(u => u.id === teacherId), [data.users, teacherId]);\n\n    const assignedCoursesData = useMemo(() => {\n        if (!teacher) return [];\n        const courses = data.courses.filter(c => c.teacherId === teacher.id);\n        \n        return courses.map(course => {\n            const courseOutcomes = data.courseOutcomes.filter(co => co.courseId === course.id);\n            const enrolledStudentIds = new Set(data.enrollments.filter(e => e.courseId === course.id).map(e => e.studentId));\n            const totalStudents = enrolledStudentIds.size;\n            \n            let studentsMeetingTargetCount = 0;\n            if (totalStudents > 0) {\n                 const studentsInCourse = data.students.filter(s => enrolledStudentIds.has(s.id));\n                 studentsInCourse.forEach(student => {\n                     // Simplified: check if student meets target for at least one CO. A full implementation would be more complex.\n                     const overallPercentage = 65; // Mock overall score for the student\n                     if (overallPercentage >= course.target) {\n                         studentsMeetingTargetCount++;\n                     }\n                 });\n            }\n\n            const overallCoAttainment = totalStudents > 0 ? (studentsMeetingTargetCount / totalStudents) * 100 : 0;\n            \n            // FIX: Assessments are linked via sections, not directly to courses. This logic finds all assessments for a course via its sections from enrollments.\n            const sectionIdsForCourse = new Set(data.enrollments.filter(e => e.courseId === course.id && e.sectionId).map(e => e.sectionId!));\n            const assessments = data.assessments\n                .filter(a => sectionIdsForCourse.has(a.sectionId))\n                .map(assessment => ({\n                    ...assessment,\n                    hasMarks: data.marks.some(m => m.assessmentId === assessment.id)\n                }));\n\n            return {\n                ...course,\n                overallCoAttainment,\n                assessments,\n            };\n        });\n    }, [data, teacher]);\n\n    if (!teacher) {\n        return <div className=\"text-center p-8 text-red-500\">Teacher not found.</div>;\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"bg-white p-6 rounded-lg shadow-md\">\n                <h1 className=\"text-3xl font-bold text-gray-800\">{teacher.name}'s Dashboard</h1>\n                <p className=\"text-gray-500\">Employee ID: {teacher.employeeId} | Overview of assigned courses and their status.</p>\n            </div>\n            \n            {assignedCoursesData.map(course => (\n                <div key={course.id} className=\"bg-white p-6 rounded-lg shadow-md\">\n                    <div className=\"flex justify-between items-start\">\n                        <div>\n                            <h2 className=\"text-2xl font-bold text-gray-800\">{course.name} ({course.code})</h2>\n                            <p className={`font-semibold text-lg ${course.overallCoAttainment >= course.target ? 'text-green-600' : 'text-orange-500'}`}>\n                                Overall CO Attainment: {course.overallCoAttainment.toFixed(2)}%\n                            </p>\n                        </div>\n                        <Link to={`/courses/${course.id}`} className=\"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 font-semibold\">\n                            Manage Course\n                        </Link>\n                    </div>\n                    <div className=\"mt-4 border-t pt-4\">\n                        <h3 className=\"text-lg font-semibold text-gray-700 mb-2\">Assessments</h3>\n                        <div className=\"space-y-2\">\n                            {course.assessments.map(assessment => (\n                                <div key={assessment.id} className=\"flex justify-between items-center p-2 bg-gray-50 rounded-md\">\n                                    <p className=\"text-gray-800\">{assessment.name}</p>\n                                    <span className={`px-3 py-1 text-xs font-semibold rounded-full ${assessment.hasMarks ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`}>\n                                        {assessment.hasMarks ? 'Uploaded' : 'Pending'}\n                                    </span>\n                                </div>\n                            ))}\n                            {course.assessments.length === 0 && <p className=\"text-gray-500\">No assessments created for this course yet.</p>}\n                        </div>\n                    </div>\n                </div>\n            ))}\n             {assignedCoursesData.length === 0 && (\n                <div className=\"text-center p-8 bg-white rounded-lg shadow-md\">\n                    <p className=\"text-gray-500\">This teacher has not been assigned any courses yet.</p>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default TeacherDetails;",
  "components/CourseFacultyAssignment.tsx": "import React, { useState, useMemo, useEffect } from 'react';\nimport { Course, User, Section } from '../types';\nimport { useAppContext } from '../hooks/useAppContext';\nimport SaveBar from './SaveBar';\nimport ConfirmationModal from './ConfirmationModal';\n\ninterface CourseFacultyAssignmentProps {\n  course: Course;\n}\n\ntype AssignmentMode = 'single' | 'section';\n\nconst CourseFacultyAssignment: React.FC<CourseFacultyAssignmentProps> = ({ course }) => {\n  const { data, setData, currentUser } = useAppContext();\n  \n  const [draftCourse, setDraftCourse] = useState<Course>(course);\n  const [initialCourse, setInitialCourse] = useState<Course>(course);\n\n  useEffect(() => {\n    setDraftCourse(course);\n    setInitialCourse(course);\n  }, [course]);\n\n  const [assignmentMode, setAssignmentMode] = useState<AssignmentMode>(\n    course.sectionTeacherIds && Object.keys(course.sectionTeacherIds).length > 0 ? 'section' : 'single'\n  );\n\n  const [confirmation, setConfirmation] = useState<{\n        isOpen: boolean;\n        title: string;\n        message: string;\n        onConfirm: () => void;\n    } | null>(null);\n\n  const { managedTeachers, courseSections } = useMemo(() => {\n    let teachers: User[] = [];\n    if (currentUser?.role === 'Program Co-ordinator') {\n        const myManagedTeacherIds = new Set(data.users\n            .filter(u => u.role === 'Teacher' && u.programCoordinatorIds?.includes(currentUser.id))\n            .map(u => u.id));\n        teachers = data.users.filter(u => myManagedTeacherIds.has(u.id));\n    }\n\n    const enrolledSectionIds = new Set(data.enrollments\n        .filter(e => e.courseId === course.id && e.sectionId)\n        .map(e => e.sectionId)\n    );\n    \n    const sections = data.sections.filter(s => enrolledSectionIds.has(s.id));\n    \n    return { managedTeachers: teachers, courseSections: sections };\n  }, [data, currentUser, course.id]);\n  \n  const isDirty = useMemo(() => JSON.stringify(draftCourse) !== JSON.stringify(initialCourse), [draftCourse, initialCourse]);\n\n  const handleModeChange = (mode: AssignmentMode) => {\n    // No change if clicking the active mode\n    if (mode === assignmentMode) return;\n\n    // Switching TO 'section' mode\n    if (mode === 'section') {\n      setConfirmation({\n        isOpen: true,\n        title: \"Confirm Assignment Mode Switch\",\n        message: \"Switching to 'Assign by Section' will clear any existing single-teacher assignment for this course. Are you sure you want to proceed?\",\n        onConfirm: () => {\n          setAssignmentMode('section');\n          setDraftCourse(prev => ({ ...prev, teacherId: null }));\n          setConfirmation(null);\n        }\n      });\n    } \n    // Switching TO 'single' mode\n    else if (mode === 'single') {\n      const hasSectionAssignments = draftCourse.sectionTeacherIds && Object.keys(draftCourse.sectionTeacherIds).length > 0;\n      if (hasSectionAssignments) {\n        setConfirmation({\n          isOpen: true,\n          title: \"Confirm Assignment Mode Switch\",\n          message: \"Switching to 'Single Teacher' will clear all existing section-specific teacher assignments. Are you sure you want to proceed?\",\n          onConfirm: () => {\n            setAssignmentMode('single');\n            setDraftCourse(prev => {\n              const { sectionTeacherIds, ...rest } = prev;\n              return rest;\n            });\n            setConfirmation(null);\n          }\n        });\n      } else {\n        // No section assignments to clear, so just switch\n        setAssignmentMode(mode);\n      }\n    }\n  };\n\n  const handleSingleTeacherChange = (teacherId: string) => {\n    setDraftCourse(prev => ({ ...prev, teacherId: teacherId || null }));\n  };\n\n  const handleSectionTeacherChange = (sectionId: string, teacherId: string) => {\n    setDraftCourse(prev => {\n        const newSectionTeachers = { ...(prev.sectionTeacherIds || {}) };\n        if (teacherId) {\n            newSectionTeachers[sectionId] = teacherId;\n        } else {\n            delete newSectionTeachers[sectionId];\n        }\n        return { ...prev, sectionTeacherIds: newSectionTeachers };\n    });\n  };\n\n  const handleSave = () => {\n    setData(prev => ({\n        ...prev,\n        courses: prev.courses.map(c => c.id === course.id ? draftCourse : c)\n    }));\n    setInitialCourse(draftCourse);\n    alert(\"Faculty assignments saved!\");\n  };\n\n  const handleCancel = () => {\n    setDraftCourse(initialCourse);\n    // Also reset the mode to match the initial state\n    setAssignmentMode(initialCourse.sectionTeacherIds && Object.keys(initialCourse.sectionTeacherIds).length > 0 ? 'section' : 'single');\n  };\n\n  return (\n    <div className=\"space-y-6 pb-20\">\n      <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-xl font-semibold text-gray-700\">Faculty Assignment</h2>\n           <div className=\"flex items-center space-x-2 rounded-lg bg-gray-200 p-1\">\n                <button \n                    onClick={() => handleModeChange('single')}\n                    className={`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${assignmentMode === 'single' ? 'bg-white text-gray-800 shadow' : 'text-gray-600 hover:bg-gray-300'}`}\n                >\n                    Single Teacher\n                </button>\n                <button \n                    onClick={() => handleModeChange('section')}\n                    className={`px-4 py-1.5 text-sm font-medium rounded-md transition-colors ${assignmentMode === 'section' ? 'bg-white text-gray-800 shadow' : 'text-gray-600 hover:bg-gray-300'}`}\n                >\n                    Assign by Section\n                </button>\n            </div>\n      </div>\n\n      {assignmentMode === 'single' && (\n        <div className=\"p-4 border rounded-lg bg-gray-50\">\n           <label htmlFor=\"single-teacher-select\" className=\"block text-sm font-medium text-gray-700\">\n               Assign a single teacher for the entire course\n            </label>\n           <select\n                id=\"single-teacher-select\"\n                value={draftCourse.teacherId || ''}\n                onChange={(e) => handleSingleTeacherChange(e.target.value)}\n                className=\"mt-2 block w-full max-w-sm pl-3 pr-10 py-2 text-base bg-white text-gray-900 border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md\"\n            >\n                <option value=\"\">-- Unassigned --</option>\n                {managedTeachers.map(teacher => (\n                    <option key={teacher.id} value={teacher.id}>{teacher.name}</option>\n                ))}\n            </select>\n            <p className=\"mt-2 text-xs text-gray-500\">This teacher will be the default unless overridden by section-specific assignments.</p>\n        </div>\n      )}\n\n      {assignmentMode === 'section' && (\n         <div className=\"p-4 border rounded-lg bg-gray-50\">\n            <h3 className=\"text-md font-medium text-gray-700 mb-4\">Assign a teacher to each section</h3>\n            <div className=\"space-y-3\">\n                {courseSections.map(section => (\n                    <div key={section.id} className=\"grid grid-cols-3 items-center gap-4\">\n                        <label htmlFor={`section-teacher-${section.id}`} className=\"font-semibold text-gray-800 text-sm\">\n                            Section {section.name}\n                        </label>\n                         <select\n                            id={`section-teacher-${section.id}`}\n                            value={draftCourse.sectionTeacherIds?.[section.id] || ''}\n                            onChange={(e) => handleSectionTeacherChange(section.id, e.target.value)}\n                            className=\"col-span-2 block w-full pl-3 pr-10 py-2 text-base bg-white text-gray-900 border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md\"\n                        >\n                            <option value=\"\">-- Use Course Default --</option>\n                            {managedTeachers.map(teacher => (\n                                <option key={teacher.id} value={teacher.id}>{teacher.name}</option>\n                            ))}\n                        </select>\n                    </div>\n                ))}\n                 {courseSections.length === 0 && (\n                    <p className=\"text-center text-gray-500 py-4\">No sections found for this course. Enroll students to see sections here.</p>\n                )}\n            </div>\n         </div>\n      )}\n      <SaveBar isDirty={isDirty} onSave={handleSave} onCancel={handleCancel} />\n      {confirmation && (\n        <ConfirmationModal\n            isOpen={confirmation.isOpen}\n            title={confirmation.title}\n            message={confirmation.message}\n            onConfirm={confirmation.onConfirm}\n            onClose={() => setConfirmation(null)}\n        />\n       )}\n    </div>\n  );\n};\n\nexport default CourseFacultyAssignment;",
  "pages/DepartmentStudentManagement.tsx": "import React, { useState, useMemo, useEffect } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { Section, Student, StudentStatus } from '../types';\nimport ExcelUploader from '../components/ExcelUploader';\nimport { Trash2 } from '../components/Icons';\nimport SaveBar from '../components/SaveBar';\nimport ConfirmationModal from '../components/ConfirmationModal';\n\nconst DepartmentStudentManagement: React.FC = () => {\n    const { currentUser, data, setData } = useAppContext();\n\n    const [selectedProgramId, setSelectedProgramId] = useState<string>('');\n    const [selectedBatch, setSelectedBatch] = useState<string>('');\n    const [newSectionName, setNewSectionName] = useState('');\n\n    // State for confirmation modal\n    const [confirmation, setConfirmation] = useState<{\n        isOpen: boolean;\n        title: string;\n        message: string;\n        onConfirm: () => void;\n    } | null>(null);\n\n    // Draft state for student edits\n    const [draftStudents, setDraftStudents] = useState<Student[]>([]);\n    const [initialStudents, setInitialStudents] = useState<Student[]>([]);\n\n    const programsInCollege = useMemo(() =>\n        data.programs.filter(p => p.collegeId === currentUser?.collegeId)\n    , [data.programs, currentUser]);\n\n    const batchesForProgram = useMemo(() => {\n        if (!selectedProgramId) return [];\n        return data.batches\n            .filter(b => b.programId === selectedProgramId)\n            .sort((a, b) => b.name.localeCompare(a.name));\n    }, [data.batches, selectedProgramId]);\n\n\n    const { sections, students } = useMemo(() => {\n        if (!selectedProgramId || !selectedBatch) {\n            return { sections: [], students: [] };\n        }\n        const batch = data.batches.find(b => b.programId === selectedProgramId && b.name === selectedBatch);\n        if (!batch) {\n            return { sections: [], students: [] };\n        }\n\n        const sectionsForBatch = data.sections.filter(s => s.batchId === batch.id);\n        const sectionIdsForBatch = new Set(sectionsForBatch.map(s => s.id));\n\n        const allStudentsForProgram = data.students.filter(s => s.programId === selectedProgramId);\n\n        // Include students in sections of this batch AND unassigned students for this program\n        const studentsToDisplay = allStudentsForProgram.filter(s => \n            !s.sectionId || sectionIdsForBatch.has(s.sectionId)\n        );\n        \n        return { sections: sectionsForBatch, students: studentsToDisplay.sort((a, b) => a.id.localeCompare(b.id)) };\n    }, [selectedProgramId, selectedBatch, data.sections, data.students, data.batches]);\n    \n    useEffect(() => {\n        setDraftStudents(students);\n        setInitialStudents(students);\n    }, [students]);\n\n    const isDirty = useMemo(() => JSON.stringify(draftStudents) !== JSON.stringify(initialStudents), [draftStudents, initialStudents]);\n\n    const handleStudentUpload = (uploadedStudents: { id: string; name: string }[]) => {\n        if (!selectedProgramId) return;\n\n        const existingStudentIds = new Set(data.students.map(s => String(s.id).toLowerCase()));\n        const newStudents: Student[] = uploadedStudents\n            .filter(row => row.id && row.name && !existingStudentIds.has(String(row.id).toLowerCase()))\n            .map(row => ({\n                id: String(row.id),\n                name: String(row.name),\n                programId: selectedProgramId,\n                status: 'Active',\n                sectionId: null\n            }));\n\n        setData(prev => ({\n            ...prev,\n            students: [...prev.students, ...newStudents]\n        }));\n        alert(`${newStudents.length} new students added to the master list. Please assign them to a section and batch.`);\n    };\n    \n    const handleAddSection = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!newSectionName.trim() || !selectedProgramId || !selectedBatch) return;\n\n        const batch = data.batches.find(b => b.programId === selectedProgramId && b.name === selectedBatch);\n        if (!batch) {\n            alert(\"Selected batch is invalid. Please refresh.\");\n            return;\n        }\n\n        const newSection: Section = {\n            id: `sec_${Date.now()}`,\n            name: newSectionName.trim().toUpperCase(),\n            programId: selectedProgramId,\n            batchId: batch.id,\n        };\n        setData(prev => ({...prev, sections: [...prev.sections, newSection]}));\n        setNewSectionName('');\n    };\n\n    const performDeleteSection = (sectionId: string) => {\n        setData(prev => {\n            // 1. Filter out the deleted section\n            const updatedSections = prev.sections.filter(s => s.id !== sectionId);\n            \n            // 2. Unassign students from that section\n            const updatedStudents = prev.students.map(student => {\n                if (student.sectionId === sectionId) {\n                    return { ...student, sectionId: null };\n                }\n                return student;\n            });\n            \n            return { \n                ...prev, \n                